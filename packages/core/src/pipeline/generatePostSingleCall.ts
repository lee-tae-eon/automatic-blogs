import { BaseAiClient } from "../ai";
import { BlogPostInput, AiGeneratedPost } from "../types/blog";
import { safeGenerate } from "../util/safeGenerate";

/**
 * ë¸”ë¡œê·¸ í˜ë¥´ì†Œë‚˜ íƒ€ì… í™•ì¥
 */
export interface ExtendedBlogPostInput extends BlogPostInput {
  persona: string;
  keywords?: string;
}

/**
 * ë©”ì¸ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìƒì„± í•¨ìˆ˜
 */
export const generatePostSingleCall = async (
  client: BaseAiClient,
  input: ExtendedBlogPostInput,
): Promise<AiGeneratedPost> => {
  const prompt =
    input.persona === "informative"
      ? generateInformativePrompt(input)
      : generateEmpatheticPrompt(input);

  const response = await safeGenerate(async () => {
    return await client.generateJson<AiGeneratedPost>(prompt);
  });

  if (!response || !response.title) {
    throw new Error("AIê°€ ìœ íš¨í•œ JSON ë°ì´í„°ë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
  }

  return response;
};

/**
 * ì •ë³´ê³µìœ í˜• í”„ë¡¬í”„íŠ¸ ìƒì„±
 */
function generateInformativePrompt(input: ExtendedBlogPostInput): string {
  const systemRole = `
# ì—­í•  ì •ì˜
ë‹¹ì‹ ì€ ìµœì‹  ì •ë³´ë¥¼ ì˜ ì •ë¦¬í•˜ì—¬ í•µì‹¬ë‚´ìš©ì„ ì „ë‹¬í•˜ëŠ” ì „ë¬¸ ë¸”ë¡œê±°ì…ë‹ˆë‹¤. ì •ë³´ì˜ ê¹Šì´ì™€ ì‹ ë¢°ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ì‚¬ëŒì´ ì§ì ‘ ì •ë¦¬í•œ ë“¯í•œ ê¸€ì„ ì”ë‹ˆë‹¤.
- ì‹œì : í˜„ì¬ ë‚ ì§œëŠ” ${new Date().toLocaleDateString()}ì…ë‹ˆë‹¤. ìµœì‹  ì •ë³´ë¥¼ ë°˜ì˜í•˜ì„¸ìš”.
- ì „ë¬¸ ë¶„ì•¼: ë…¼ë¦¬ì  êµ¬ì¡°, ë°ì´í„° ê¸°ë°˜ ë¶„ì„, ${input.topic} ì „ë¬¸ê°€.
- í•µì‹¬ ì›ì¹™: ê¸€ì˜ ë‚´ìš©ì€ í•µì‹¬ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ëŒì´ ì½ê¸° ì¢‹ê²Œ(ê°€ë…ì„±) ì˜ ì„¸ë¶„í™” í•˜ì—¬ ì •ë¦¬í•˜ì—¬ì•¼ í•¨.
`;

  const contentStructure = `
# ì½˜í…ì¸  êµ¬ì¡° ë° ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

## ğŸ“ ì†Œì œëª© ë° ë¬¸ë‹¨ êµ¬ì„± ê·œì¹™ (í•„ìˆ˜)
1. **ì†Œì œëª© ê°œìˆ˜**: ë°˜ë“œì‹œ **ì •í™•íˆ 5ê°œ**ì˜ ì†Œì œëª© ì„¹ì…˜ì„ ì‘ì„±í•˜ì„¸ìš”.
2. **ì†Œì œëª© í˜•ì‹ (ì¸ìš©êµ¬ ë¸”ë¡ ìµœì í™”)**:
   - ëª¨ë“  ì†Œì œëª©ì€ ë°˜ë“œì‹œ \`\\n\\n> ## ì†Œì œëª©ëª…\\n\\n\` í˜•ì‹ì„ ì‚¬ìš©í•˜ì„¸ìš”.
   - **ì¤‘ìš”**: \`>\` ê¸°í˜¸ ì•ë’¤ë¡œ ë°˜ë“œì‹œ **ë¹ˆ ì¤„(Double Newline)**ì´ ìˆì–´ì•¼ ë„¤ì´ë²„ ì—ë””í„°ì—ì„œ ì¸ìš©êµ¬ ë°•ìŠ¤ë¡œ ì¸ì‹ë©ë‹ˆë‹¤.
   - ì†Œì œëª© ê¸°í˜¸(\`> ##\`)ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ì—ëŠ” ë°˜ë“œì‹œ **í•œ ì¹¸ì˜ ê³µë°±**ì„ ë‘ì„¸ìš”.
3. **ë¬¸ì¥ ê¸¸ì´ ì œí•œ**: ê° ì†Œì œëª© ì•„ë˜ì˜ ë³¸ë¬¸ ë¬¸ì¥ì€ **200ì ì´í•˜**ë¡œ ì§§ê²Œ ì‘ì„±í•˜ì„¸ìš”.
4. **ë¬¸ë‹¨ êµ¬ì„±**: 2~3ë¬¸ì¥ë§ˆë‹¤ ë¹ˆ ì¤„ì„ ì‚½ì…í•˜ì—¬ ëª¨ë°”ì¼ ê°€ë…ì„±ì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”.

## ğŸ“ ë³¸ë¬¸ ë ˆì´ì•„ì›ƒ ì˜ˆì‹œ
---
(ë¹ˆ ì¤„)
> ## 1. ì²« ë²ˆì§¸ ì„¹ì…˜ ì œëª©
(ë¹ˆ ì¤„)
ë³¸ë¬¸ ë‚´ìš© ì‹œì‘...
---
`;

  const commonInstructions = `
## ğŸ¨ ì‹œê°ì  ìš”ì†Œ ë° SEO
- **ì´ëª¨ì§€**: ì†Œì œëª©ì— 1ê°œì”©ë§Œ ì‚¬ìš©. ë³¸ë¬¸ì—” ìµœì†Œí™”.
- **í‘œ(Table)**: ë¹„êµ ë¶„ì„ í‘œë¥¼ ë°˜ë“œì‹œ 1ê°œ ì´ìƒ í¬í•¨í•˜ì„¸ìš”.
- **ê°•ì¡°**: í•µì‹¬ í‚¤ì›Œë“œëŠ” **ë³¼ë“œì²˜ë¦¬**ë¥¼ í•˜ì„¸ìš”.
- **êµ¬ë¶„ì„ **: ê° ì†Œì œëª© ì„¹ì…˜ ìƒë‹¨ì— \`--- \`ë¥¼ ì‚½ì…í•˜ì„¸ìš”.
`;

  return `
${systemRole}
${contentStructure}
${commonInstructions}

# ğŸ¯ ì‘ì„± ë¯¸ì…˜
"${input.topic}" ì£¼ì œë¡œ ì •ë³´ê³µìœ í˜• í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

## ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì†Œì œëª©ì€ ë°˜ë“œì‹œ 5ê°œì´ë©° \`\\n\\n> ## ì†Œì œëª©\\n\\n\` í˜•ì‹ì„ ì² ì €íˆ ì§€í‚¬ ê²ƒ.
- [ ] ì†Œì œëª© ì¤„ì—ëŠ” ë‹¤ë¥¸ í…ìŠ¤íŠ¸ë¥¼ ì ˆëŒ€ ì„ì§€ ë§ ê²ƒ.

## ì¶œë ¥ í˜•ì‹ (ìˆœìˆ˜ JSONë§Œ)
{
  "title": "ì œëª©",
  "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3", "ì†Œì œëª©4", "ì†Œì œëª©5"],
  "content": "ë³¸ë¬¸ ë‚´ìš©",
  "metaTitle": "SEO ì œëª©",
  "metaDescription": "SEO ì„¤ëª…",
  "focusKeywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"]
}

**ë°˜ë“œì‹œ ì§€í‚¬ ê²ƒ (ì†Œì œëª© ê·œì¹™)**
1. 'content' í•„ë“œ ë‚´ì—ì„œ ì†Œì œëª©ì„ ì‘ì„±í•  ë•Œ, ì†Œì œëª© ì‹œì‘ ì „ê³¼ ì¢…ë£Œ í›„ì— ë°˜ë“œì‹œ \`\\n\\n\`ì„ ë„£ì–´ ë…ë¦½ëœ ë¸”ë¡ì„ ë§Œë“œì„¸ìš”.
   ì˜ˆ: "...ì´ì „ ë¬¸ë‹¨.\\n\\n> ## ğŸ“Œ ìƒˆë¡œìš´ ì†Œì œëª©\\n\\në‹¤ìŒ ë¬¸ë‹¨..."
2. ì¸ìš©êµ¬ ê¸°í˜¸(\`>\`) ë°”ë¡œ ë’¤ì— ì œëª© íƒœê·¸(\`##\`)ë¥¼ ë¶™ì—¬ì„œ ì‘ì„±í•˜ì„¸ìš”.
3. ì‘ë‹µì€ ì˜¤ì§ ìˆœìˆ˜í•œ JSON í˜•ì‹ë§Œ í—ˆìš©í•©ë‹ˆë‹¤.
`;
}
// function generateInformativePrompt(input: ExtendedBlogPostInput): string {
//   const systemRole = `
// # ì—­í•  ì •ì˜
// ë‹¹ì‹ ì€ ìµœì‹  ì •ë³´ë¥¼ ì˜ ì •ë¦¬í•˜ì—¬ í•µì‹¬ë‚´ìš©ì„ ì „ë‹¬í•˜ëŠ” ì „ë¬¸ ë¸”ë¡œê±°ì…ë‹ˆë‹¤. ì •ë³´ì˜ ê¹Šì´ì™€ ì‹ ë¢°ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ì‚¬ëŒì´ ì§ì ‘ ì •ë¦¬í•œ ë“¯í•œ ê¸€ì„ ì”ë‹ˆë‹¤.
// - ì‹œì : í˜„ì¬ ë‚ ì§œëŠ” ${new Date().toLocaleDateString()}ì…ë‹ˆë‹¤. ìµœì‹  ì •ë³´ë¥¼ ë°˜ì˜í•˜ì„¸ìš”. ë‚ ì§œë¥¼ ë°˜ì˜í•˜ëŠ”ê²Œ ì•„ë‹™ë‹ˆë‹¤.
// - ì „ë¬¸ ë¶„ì•¼: ë…¼ë¦¬ì  êµ¬ì¡°, ë°ì´í„° ê¸°ë°˜ ë¶„ì„, ${input.topic} ì „ë¬¸ê°€.
// - í•µì‹¬ ì›ì¹™: "ê¸€ì˜ ë‚´ìš©ì€ í•µì‹¬ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ëŒì´ ì½ê¸° ì¢‹ê²Œ(ê°€ë…ì„±) ì˜ ì„¸ë¶„í™” í•˜ì—¬ ì •ë¦¬í•˜ì—¬ì•¼í•¨.
// `;

//   const contentStructure = `
// # ì½˜í…ì¸  êµ¬ì¡° ë° ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

// ## ğŸ“ ì†Œì œëª© ë° ë¬¸ë‹¨ êµ¬ì„± ê·œì¹™ (í•„ìˆ˜)
// 1. **ì†Œì œëª© ê°œìˆ˜**: ë°˜ë“œì‹œ **5ê°œ~6ê°œ**ì˜ ì†Œì œëª© ì„¹ì…˜ì„ ì‘ì„±í•˜ì„¸ìš”.
// 2. **ì†Œì œëª© í˜•ì‹**: ëª¨ë“  ì†Œì œëª©ì€ ë°˜ë“œì‹œ \`> ## ì†Œì œëª©ëª…\` í˜•ì‹ì„ ì‚¬ìš©í•˜ì„¸ìš”.
//    - ì´ í˜•ì‹ì€ ë„¤ì´ë²„ ì—ë””í„°ì—ì„œ 'ì¸ìš©êµ¬(ë”°ì˜´í‘œ)' ë¸”ë¡ìœ¼ë¡œ ë³€í™˜ë˜ì–´ ì¤‘ì•™ ì •ë ¬ íš¨ê³¼ë¥¼ ì¤ë‹ˆë‹¤.
// 3. **ë¬¸ì¥ ê¸¸ì´ ì œí•œ**: ê° ì†Œì œëª© ì•„ë˜ì˜ ë³¸ë¬¸ ë¬¸ì¥ì€ **200ì ì´í•˜**ë¡œ ì§§ê²Œ ì‘ì„±í•˜ì„¸ìš”. í˜¸í¡ì´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ ì£¼ì˜í•˜ì„¸ìš”.
// 4. **ë¬¸ë‹¨ êµ¬ì„±**: 2~3ë¬¸ì¥ë§ˆë‹¤ ë¹ˆ ì¤„ì„ ì‚½ì…í•˜ì—¬ ëª¨ë°”ì¼ ê°€ë…ì„±ì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”.

// ## ğŸ“ ë³¸ë¬¸ ë ˆì´ì•„ì›ƒ ì˜ˆì‹œ
// \`\`\`markdown
// ë„ì…ë¶€ (ì¸ì‚¬ë§ ë° ë°°ê²½ ì„¤ëª…)

// ---
// > ## 1. ì²« ë²ˆì§¸ ì„¹ì…˜ ì œëª©
// (ê³µë°± í•œ ì¤„)
// (ê³µë°± í•œ ì¤„)
// (ê³µë°± í•œ ì¤„)

// (200ì ì´ë‚´ì˜ ê°„ê²°í•œ ì„¤ëª… ë¬¸ë‹¨)

// ---
// > ## 2. ë‘ ë²ˆì§¸ ì„¹ì…˜ ì œëª©
// (ê³µë°± í•œ ì¤„)
// (ê³µë°± í•œ ì¤„)

// (ë¹„êµ í‘œ ë˜ëŠ” ìƒì„¸ ë¦¬ìŠ¤íŠ¸ í¬í•¨)
// ... (ì´ 5ê°œì˜ ì†Œì œëª© ì„¹ì…˜ ë°˜ë³µ)
// \`\`\`
// `;

//   const commonInstructions = `
// ## ğŸ¨ ì‹œê°ì  ìš”ì†Œ ë° SEO
// - **ì´ëª¨ì§€**: ì†Œì œëª©ì— 1ê°œì”©ë§Œ ì‚¬ìš© (ğŸ“Œ, ğŸ’¡ ë“±). ë³¸ë¬¸ì—” ìµœì†Œí™”.
// - **í‘œ(Table)**: ì •ë³´ê³µìœ í˜•ì´ë¯€ë¡œ ë¹„êµ ë¶„ì„ í‘œë¥¼ ë°˜ë“œì‹œ 1ê°œ ì´ìƒ í¬í•¨í•˜ì„¸ìš”.
// - **ê°•ì¡°**: í•µì‹¬ í‚¤ì›Œë“œëŠ” **ë³¼ë“œì²˜ë¦¬** ë° ê°•ì¡° ìƒ‰ìƒì„ ì£¼ì„¸ìš”.
// - **êµ¬ë¶„ì„ **: ê° ì†Œì œëª© ì„¹ì…˜ ìƒë‹¨ì— \`--- \`ë¥¼ ì‚½ì…í•˜ì„¸ìš”.
// `;

//   return `
// ${systemRole}
// ${contentStructure}
// ${commonInstructions}

// # ğŸ¯ ì‘ì„± ë¯¸ì…˜
// "${input.topic}" ì£¼ì œë¡œ ì •ë³´ê³µìœ í˜• í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

// ## ì²´í¬ë¦¬ìŠ¤íŠ¸
// - [ ] ì†Œì œëª©ì€ ë°˜ë“œì‹œ **5ê°œ**ì´ë©° \`> ## \` í˜•ì‹ì„ ì‚¬ìš©í•  ê²ƒ.
// - [ ] ê° ë¬¸ì¥ì€ **200ì ì´ë‚´**ë¡œ ì‘ì„±í•  ê²ƒ.
// - [ ] ì„¹ì…˜ ì‚¬ì´ë§ˆë‹¤ êµ¬ë¶„ì„ (---)ì„ ë„£ì„ ê²ƒ.
// - [ ] ë¹„êµ ë¶„ì„ í‘œë¥¼ 1ê°œ ì´ìƒ í¬í•¨í•  ê²ƒ.

// ## ì¶œë ¥ í˜•ì‹ (ìˆœìˆ˜ JSONë§Œ)
// {
//   "title": "ì œëª©",
//   "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3", "ì†Œì œëª©4", "ì†Œì œëª©5"],
//   "content": "ë³¸ë¬¸ ë‚´ìš© (\\nìœ¼ë¡œ ì¤„ë°”ê¿ˆ)",
//   "metaTitle": "SEO ì œëª©",
//   "metaDescription": "SEO ì„¤ëª…",
//   "focusKeywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"]
// }

// **ë°˜ë“œì‹œ ì§€í‚¬ ê²ƒ**
// 1. ì‘ë‹µì€ ì˜¤ì§ ìˆœìˆ˜í•œ JSON í˜•ì‹ë§Œ í—ˆìš©í•©ë‹ˆë‹¤.
// 2. 'content' ë‚´ë¶€ì— ì‹¤ì œ ì¤„ë°”ê¿ˆì„ ì‚¬ìš©í•˜ì§€ ë§ê³  ë°˜ë“œì‹œ '\\\\n' ê¸°í˜¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
// 3. ë„¤ì´ë²„ ë¸”ë¡œê·¸ëŠ” ë§ˆí¬ë‹¤ìš´ì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ \`> ## \` ì™¸ì˜ íŠ¹ìˆ˜ ê¸°í˜¸(### ë“±)ëŠ” ì‚¼ê°€ì„¸ìš”.
// `;
// }

/**
 * ê³µê°í˜• í”„ë¡¬í”„íŠ¸ ìƒì„±
 */
/**
 * ê³µê°í˜• í”„ë¡¬í”„íŠ¸ ìƒì„±
 */
function generateEmpatheticPrompt(input: ExtendedBlogPostInput): string {
  const systemRole = `
# ì—­í•  ì •ì˜
ë‹¹ì‹ ì€ ì§ì ‘ ê²½í—˜í•˜ê³  ëŠë‚€ ì ì„ ì˜ í‘œí˜„í•˜ëŠ” ì²´í—˜í˜• ë¸”ë¡œê±°ì…ë‹ˆë‹¤. ë‚´ê°€ ì§ì ‘ ì²´í—˜í•œ ìì—°ìŠ¤ëŸ¬ìš´ ê²½í—˜ ê¸°ë°˜ ìŠ¤í† ë¦¬í…”ë§ì„ êµ¬ì‚¬í•©ë‹ˆë‹¤.
- ì‹œì : í˜„ì¬ ë‚ ì§œ ${new Date().toLocaleDateString()} ê¸°ì¤€ ìµœì‹  ì •ë³´ë¥¼ ë°˜ì˜í•˜ì„¸ìš”.
- í•µì‹¬ ì›ì¹™: ì „ë¬¸ê°€ë¼ëŠ” ëŠë‚Œì„ ì£¼ì§€ ì•Šê³ , ê³µê°ê³¼ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ìˆ˜í•„ í˜•ì‹ì„ ì§€í–¥í•©ë‹ˆë‹¤.
`;

  return `
${systemRole}

## ğŸ“ ì†Œì œëª© ë° ë¬¸ë‹¨ êµ¬ì„± ê·œì¹™ (í•„ìˆ˜)
1. **ì†Œì œëª© ê°œìˆ˜**: ë°˜ë“œì‹œ **ì •í™•íˆ 5ê°œ**ì˜ ì†Œì œëª© ì„¹ì…˜ì„ ì‘ì„±í•˜ì„¸ìš”.
2. **ì†Œì œëª© í˜•ì‹ (ì¸ìš©êµ¬ ë¸”ë¡ ìµœì í™”)**:
   - ëª¨ë“  ì†Œì œëª©ì€ ë°˜ë“œì‹œ \`\\n\\n> ## ì†Œì œëª©ëª…\\n\\n\` í˜•ì‹ì„ ì‚¬ìš©í•˜ì„¸ìš”.
   - **ì¤‘ìš”**: \`>\` ê¸°í˜¸ ì•ë’¤ë¡œ ë°˜ë“œì‹œ **ë¹ˆ ì¤„(Double Newline)**ì´ ìˆì–´ì•¼ ë„¤ì´ë²„ ì—ë””í„°ì—ì„œ ì¸ìš©êµ¬ ë°•ìŠ¤ë¡œ ì¸ì‹ë©ë‹ˆë‹¤.
   - ì†Œì œëª© ê¸°í˜¸(\`> ##\`)ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ì—ëŠ” ë°˜ë“œì‹œ **í•œ ì¹¸ì˜ ê³µë°±**ì„ ë‘ì„¸ìš”.
3. **ë¬¸ì¥ ê¸¸ì´ ì œí•œ**: ê° ì†Œì œëª© ì•„ë˜ì˜ ë³¸ë¬¸ ë¬¸ì¥ì€ **200ì ì´í•˜**ë¡œ ì§§ê²Œ ì‘ì„±í•˜ì„¸ìš”.
4. **ë¬¸ë‹¨ êµ¬ì„±**: 2~3ë¬¸ì¥ë§ˆë‹¤ ë¹ˆ ì¤„ì„ ì‚½ì…í•˜ì—¬ ëª¨ë°”ì¼ ê°€ë…ì„±ì„ ê·¹ëŒ€í™”í•˜ì„¸ìš”.
5. **ì–´ì¡°**: "~í–ˆì–´ìš”", "~ë„¤ìš”" ë“± ì¹œê·¼í•˜ê³  ë‹¤ì •ë‹¤ê°í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

# ğŸ¯ ì‘ì„± ë¯¸ì…˜
"${input.topic}" ì£¼ì œë¡œ ê³µê°í˜• í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

## í•„ìˆ˜ ì¤€ìˆ˜ ì‚¬í•­
- [ ] ì†Œì œëª©ì€ ë°˜ë“œì‹œ 5ê°œ ì´ìƒì´ë©° \`\\n\\n> ## ì†Œì œëª©\\n\\n\` í˜•ì‹ì„ ì² ì €íˆ ì§€í‚¬ ê²ƒ.
- [ ] ì‹¤ì œ ê²½í—˜ì´ ë¬»ì–´ë‚˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì„œìˆ ì„ ì‚¬ìš©í•  ê²ƒ.
- [ ] í‘œ(Table) ì‚¬ìš© ê¸ˆì§€ (ê³µê°í˜•ì€ í…ìŠ¤íŠ¸ ì¤‘ì‹¬ì˜ ìŠ¤í† ë¦¬í…”ë§).

## ì¶œë ¥ í˜•ì‹ (ìˆœìˆ˜ JSONë§Œ)
{
  "title": "ì¹œê·¼í•œ ì œëª©",
  "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3", "ì†Œì œëª©4", "ì†Œì œëª©5"],
  "content": "ë³¸ë¬¸ ë‚´ìš©",
  "tags": ["íƒœê·¸1", "íƒœê·¸2"]
}

**ë°˜ë“œì‹œ ì§€í‚¬ ê²ƒ (ì†Œì œëª© ê·œì¹™)**
1. 'content' í•„ë“œ ë‚´ì—ì„œ ì†Œì œëª©ì„ ì‘ì„±í•  ë•Œ, ì†Œì œëª© ì‹œì‘ ì „ê³¼ ì¢…ë£Œ í›„ì— ë°˜ë“œì‹œ \`\\n\\n\`ì„ ë„£ì–´ ë…ë¦½ëœ ë¸”ë¡ì„ ë§Œë“œì„¸ìš”.
   ì˜ˆ: "...ì°¸ ì¢‹ë”ë¼ê³ ìš”.\\n\\n> ## ğŸ˜Š ì†Œì œëª© ë‚´ìš©\\n\\nì •ë§ ì¶”ì²œí•´ìš”..."
2. ì¸ìš©êµ¬ ê¸°í˜¸(\`>\`) ë°”ë¡œ ë’¤ì— ì œëª© íƒœê·¸(\`##\`)ë¥¼ ë¶™ì—¬ì„œ ì‘ì„±í•˜ì„¸ìš”.
3. ì‘ë‹µì€ ì˜¤ì§ ìˆœìˆ˜í•œ JSON í˜•ì‹ë§Œ í—ˆìš©í•˜ë©°, ì¤„ë°”ê¿ˆì€ \`\\n\` ê¸°í˜¸ë¡œ ì²˜ë¦¬í•˜ì„¸ìš”.
`;
}
// function generateEmpatheticPrompt(input: ExtendedBlogPostInput): string {
//   const systemRole = `
// # ì—­í•  ì •ì˜
// ë‹¹ì‹ ì€ ì§ì ‘ ê²½í—˜í•˜ê³  ëŠë‚Œì ì„ ì˜ í‘œí˜„í•˜ëŠ” ì²´í—˜í˜• ë¸”ë¡œê±°ì…ë‹ˆë‹¤. ë‚´ê°€ ì§ì ‘ ì²´í—˜í•œ ìì—°ìŠ¤ëŸ¬ìš´ ê²½í—˜ ê¸°ë°˜ ìŠ¤í† ë¦¬í…”ë§ì„ êµ¬ì‚¬í•©ë‹ˆë‹¤.
// - ì‹œì : í˜„ì¬ ë‚ ì§œ ${new Date().toLocaleDateString()} ê¸°ì¤€ ìµœì‹  ì •ë³´ë¥¼ ë°˜ì˜í•˜ì„¸ìš”. ë‚ ì§œë¥¼ ë°˜ì˜í•˜ëŠ”ê²Œ ì•„ë‹™ë‹ˆë‹¤.
// - í•µì‹¬ ì›ì¹™: ì „ë¬¸ê°€ë¼ëŠ” ëŠë‚Œì„ ì£¼ë©´ ì•ˆë©ë‹ˆë‹¤. ë‹¨ ê³µê°í•˜ê³  ê²½í—˜í•œ ë‚´ìš©ì„ ìˆ˜í•„ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
// `;

//   return `
// ${systemRole}

// # ì½˜í…ì¸  êµ¬ì¡° ê°€ì´ë“œ
// 1. **ì†Œì œëª©(H2)**: ë°˜ë“œì‹œ **5ê°œ ~ 6ê°œ**ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
// 2. **ì†Œì œëª© í˜•ì‹**: ë°˜ë“œì‹œ \`> ## ì†Œì œëª©ëª…\` í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì¸ìš©êµ¬ ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ì„¸ìš”.
// 3. **ë¬¸ì¥ ê¸¸ì´**: ëª¨ë°”ì¼ ê°€ë…ì„±ì„ ìœ„í•´ ëª¨ë“  ë¬¸ì¥ì€ **200ì ì´í•˜**ë¡œ ì‘ì„±í•˜ì„¸ìš”.
// 4. **ì–´ì¡°**: "~í–ˆì–´ìš”", "~ë„¤ìš”" ë“± ì¹œê·¼í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

// # ğŸ¯ ì‘ì„± ë¯¸ì…˜
// "${input.topic}" ì£¼ì œë¡œ ê³µê°í˜• í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

// ## í•„ìˆ˜ ì¤€ìˆ˜ ì‚¬í•­
// - [ ] ì†Œì œëª© 5~6ê°œ (\`> ## \` í˜•ì‹)
// - [ ] ê° ë¬¸ì¥ 200ì ì´ë‚´ ì‘ì„±
// - [ ] ì‹¤ì œ ê²½í—˜ì´ ë¬»ì–´ë‚˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì„œìˆ 
// - [ ] í‘œ ì‚¬ìš© ê¸ˆì§€ (ê³µê°í˜•ì€ í…ìŠ¤íŠ¸ ì¤‘ì‹¬)

// ## ì¶œë ¥ í˜•ì‹ (ìˆœìˆ˜ JSONë§Œ)
// {
//   "title": "ì¹œê·¼í•œ ì œëª©",
//   "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3", "ì†Œì œëª©4", "ì†Œì œëª©5"],
//   "content": "ë³¸ë¬¸ ë‚´ìš© (\\nìœ¼ë¡œ ì¤„ë°”ê¿ˆ)",
//   "tags": ["íƒœê·¸1", "íƒœê·¸2"]
// }

// **ë°˜ë“œì‹œ ì§€í‚¬ ê²ƒ**
// 1. ì‘ë‹µì€ ì˜¤ì§ ìˆœìˆ˜í•œ JSON í˜•ì‹ë§Œ í—ˆìš©í•©ë‹ˆë‹¤.
// 2. 'content' ë‚´ë¶€ì— '\\n' ê¸°í˜¸ë¡œ ì¤„ë°”ê¿ˆì„ ì²˜ë¦¬í•˜ì„¸ìš”.
// 3. ì†Œì œëª© ì¸ìš©êµ¬ ë¬¸ë²•(\`> ## \`)ì„ ì² ì €íˆ ì§€í‚¤ì„¸ìš”.
// `;
// }

/**
 * ìƒì„±ëœ ì½˜í…ì¸  í’ˆì§ˆ ê²€ì¦ ë¡œì§
 */
export const validatePostQuality = (
  post: AiGeneratedPost,
  input: ExtendedBlogPostInput,
): { isValid: boolean; errors: string[] } => {
  const errors: string[] = [];

  // 1. ì†Œì œëª© ê°œìˆ˜ ë° í˜•ì‹ ê²€ì¦ (5ê°œ ê³ ì • ë° ì¸ìš©êµ¬ ë¬¸ë²• ì²´í¬)
  const quoteH2Count = (post.content.match(/^> ## /gm) || []).length;
  if (quoteH2Count !== 5) {
    errors.push(`ì†Œì œëª© ê°œìˆ˜ ì˜¤ë¥˜: ${quoteH2Count}ê°œ ë°œê²¬ (ë°˜ë“œì‹œ 5ê°œì—¬ì•¼ í•¨)`);
  }

  // 2. ë¬¸ì¥ ê¸¸ì´ ê²€ì¦ (ê°œë³„ ë¬¸ì¥ì´ 200ì ì´í•˜ì¸ì§€ ì²´í¬)
  const sentences = post.content.split(/[.!?]\s|\n/);
  for (const s of sentences) {
    if (s.trim().length > 200) {
      errors.push(`ë¬¸ì¥ ê¸¸ì´ ì´ˆê³¼: 200ìë¥¼ ë„˜ëŠ” ë¬¸ì¥ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      break;
    }
  }

  // 3. í˜ë¥´ì†Œë‚˜ë³„ í•„ìˆ˜ ìš”ì†Œ ê²€ì¦
  if (input.persona === "informative") {
    const hasTable = post.content.includes("|");
    if (!hasTable) errors.push("ì •ë³´ê³µìœ í˜•: ë¹„êµ í‘œê°€ ì—†ìŠµë‹ˆë‹¤.");
  } else if (input.persona === "empathetic") {
    const hasTable = post.content.includes("|");
    if (hasTable) errors.push("ê³µê°í˜•: í‘œë¥¼ ì œê±°í•˜ê³  ì„œìˆ í˜•ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.");
  }

  return {
    isValid: errors.length === 0,
    errors,
  };
};
