import { BaseAiClient } from "../ai";
import { BlogPostInput, AiGeneratedPost } from "../types/blog";
import { safeGenerate } from "../util/safeGenerate";

/**
 * SEO ë©”íƒ€ë°ì´í„° ìƒì„±
 */

/**
 * ë©”ì¸ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìƒì„±
 */
export const generatePostSingleCall = async (
  client: BaseAiClient,
  input: BlogPostInput,
): Promise<AiGeneratedPost> => {
  const systemRole = `
# ì—­í•  ì •ì˜
ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ë¸”ë¡œê·¸ ìƒìœ„ ë…¸ì¶œ ì „ë¬¸ê°€ì´ì ì½˜í…ì¸  ì „ëµê°€ì…ë‹ˆë‹¤.

## ì „ë¬¸ ë¶„ì•¼
- ë„¤ì´ë²„ ë¸”ë¡œê·¸ & í‹°ìŠ¤í† ë¦¬ SEO ìµœì í™”
- ê²€ìƒ‰ ì˜ë„ ê¸°ë°˜ ì½˜í…ì¸  ì„¤ê³„
- ë…ì ëª°ì…ë„ ê·¹ëŒ€í™” ê¸€ì“°ê¸°
- ë°ì´í„° ê¸°ë°˜ í‚¤ì›Œë“œ ì „ëµ

## í•µì‹¬ ì›ì¹™
1. **ê²€ìƒ‰ì ì˜ë„ ìš°ì„ **: ê²€ìƒ‰ì–´ ë’¤ì— ìˆ¨ì€ ì§„ì§œ ë‹ˆì¦ˆë¥¼ íŒŒì•…
2. **ê°€ì¹˜ ì „ë‹¬**: ì¥í™©í•œ ì„œë¡  ëŒ€ì‹  ì¦‰ì‹œ í•µì‹¬ ì •ë³´ ì œê³µ
3. **ì‹ ë¢° êµ¬ì¶•**: ê°œì¸ ê²½í—˜ê³¼ êµ¬ì²´ì  ë°ì´í„°ë¡œ ë’·ë°›ì¹¨
4. **í–‰ë™ ìœ ë„**: ì½ê³  ë‚˜ì„œ ë¬´ì—‡ì„ í•´ì•¼ í• ì§€ ëª…í™•íˆ ì œì‹œ
`;

  const contextAnalysis = `
# ì£¼ì œ ë¶„ì„ ë° ì „ëµ ìˆ˜ë¦½

[ì…ë ¥ëœ ì£¼ì œ]
"${input.topic}"

## 1ë‹¨ê³„: ê²€ìƒ‰ ì˜ë„ íŒŒì•…
ì´ ì£¼ì œë¡œ ê²€ìƒ‰í•˜ëŠ” ì‚¬ëŒì€ ë¬´ì—‡ì„ ì›í•˜ëŠ”ê°€?
- ì •ë³´í˜•(Know): ê°œë…/ë°©ë²•ì„ ì•Œê³  ì‹¶ë‹¤
- íƒìƒ‰í˜•(Go): íŠ¹ì • ì‚¬ì´íŠ¸/ì¥ì†Œë¥¼ ì°¾ëŠ”ë‹¤
- ê±°ë˜í˜•(Do): êµ¬ë§¤/ì˜ˆì•½/ì‹ ì²­í•˜ë ¤ í•œë‹¤
- ìƒì—…ì¡°ì‚¬í˜•(Buy): êµ¬ë§¤ ì „ ë¹„êµ/ê²€í† í•œë‹¤

â†’ ì´ ì˜ë„ì— ìµœì í™”ëœ êµ¬ì¡°ë¡œ ì‘ì„±í•˜ë¼.

## 2ë‹¨ê³„: íƒ€ê²Ÿ ë…ì ì„¤ì •
- ì´ ì£¼ì œì— ê´€ì‹¬ ìˆëŠ” ì‚¬ëŒì˜ ë‚˜ì´/ì„±ë³„/ì§ì—…ì€?
- ì‚¬ì „ ì§€ì‹ ìˆ˜ì¤€ì€? (ì´ˆë³´/ì¤‘ê¸‰/ì „ë¬¸ê°€)
- ì–´ë–¤ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì‹¶ì–´ í•˜ëŠ”ê°€?

## 3ë‹¨ê³„: ì°¨ë³„í™” í¬ì¸íŠ¸ ë°œêµ´
ê²½ìŸ ì½˜í…ì¸ ì™€ ë‹¤ë¥´ê²Œ ì œê³µí•  ìˆ˜ ìˆëŠ” ê°€ì¹˜:
- ë…ìì  ê²½í—˜/ì‚¬ë¡€
- ìµœì‹  ì •ë³´/íŠ¸ë Œë“œ
- ì‹¤ìš©ì  íŒ/ì²´í¬ë¦¬ìŠ¤íŠ¸
- ë¹„êµ/ë¶„ì„ ë°ì´í„°
`;

  const contentStructure = `
# ì½˜í…ì¸  êµ¬ì¡° ì„¤ê³„

## ğŸ“Œ ì œëª© ì‘ì„± ê³µì‹ (ë‘˜ ì¤‘ íƒì¼)
**ê³µì‹ 1: ìˆ«ì + í˜œíƒ + í‚¤ì›Œë“œ**
ì˜ˆ: "2025ë…„ ê¼­ ê°€ë´ì•¼ í•  ì œì£¼ë„ ìˆ¨ì€ ì¹´í˜ BEST 7"

**ê³µì‹ 2: ë¬¸ì œ ì œê¸° + í•´ê²°ì±…**
ì˜ˆ: "ë°°ë‚­ì—¬í–‰ ì§ ì¤„ì´ëŠ” ë²•? 10ë…„ ì°¨ ì—¬í–‰ëŸ¬ì˜ íŒ¨í‚¹ ë…¸í•˜ìš°"

**í•„ìˆ˜ ìš”ì†Œ:**
- ë©”ì¸ í‚¤ì›Œë“œë¥¼ ì œëª© ì•ìª½ 1/3 ì´ë‚´ ë°°ì¹˜
- ì—°ë„ë‚˜ ìˆ«ìë¡œ ì‹ ë¢°ë„ ê°•í™” (2025, 7ê°€ì§€, 3ë¶„ ë“±)
- ê°íƒ„ì‚¬ë‚˜ ì§ˆë¬¸ìœ¼ë¡œ í˜¸ê¸°ì‹¬ ìœ ë°œ
- 30ì ì´ë‚´ ê¶Œì¥ (ëª¨ë°”ì¼ ë¯¸ë¦¬ë³´ê¸° ê³ ë ¤)

## ğŸ¯ ë„ì…ë¶€ (ì²« 3ë¬¸ì¥ì´ ìƒëª…)
**"3ì´ˆ ì•ˆì— ì‚¬ë¡œì¡ê¸°" ì „ëµ:**

âŒ ë‚˜ìœ ì˜ˆ:
"ìš”ì¦˜ ë¸”ë¡œê·¸ê°€ ì¸ê¸°ì¸ë°ìš”, ë§ì€ ë¶„ë“¤ì´ ê¶ê¸ˆí•´í•˜ì‹œë”ë¼êµ¬ìš”."

âœ… ì¢‹ì€ ì˜ˆ:
"ë¸”ë¡œê·¸ 3ê°œì›” ë§Œì— ì›” 300ë§Œì› ë²Œì—ˆìŠµë‹ˆë‹¤. ğŸ˜®
ì €ë„ ì²˜ìŒì—” 'ì„¤ë§ˆ ë‚˜ë„?'í–ˆì§€ë§Œ, ë”± 3ê°€ì§€ë§Œ ë°”ê¿¨ë”ë‹ˆ ê°€ëŠ¥í–ˆì–´ìš”.
ì˜¤ëŠ˜ì€ ê·¸ ë¹„ë²•ì„ ìˆ¨ê¹€ì—†ì´ ê³µê°œí•©ë‹ˆë‹¤."

**êµ¬ì„±:**
1. ê°•ë ¬í•œ íŒ©íŠ¸/ì§ˆë¬¸ìœ¼ë¡œ í›…(Hook)
2. ë…ìì˜ ê³ ë¯¼ ê³µê°
3. "ì´ ê¸€ì„ ì½ìœ¼ë©´ ì–»ì„ ê²ƒ" ëª…ì‹œ

## ğŸ“ ë³¸ë¬¸ êµ¬ì¡°
\`\`\`
ì†Œì œëª© 1: í•µì‹¬ ê°œë… ì„¤ëª… (Why)
â”œâ”€ ì™œ ì´ê²Œ ì¤‘ìš”í•œê°€?
â”œâ”€ í†µê³„/ë°ì´í„°ë¡œ ë’·ë°›ì¹¨
â””â”€ ê°œì¸ ê²½í—˜ í•œ ì¤„

ì†Œì œëª© 2: êµ¬ì²´ì  ë°©ë²•ë¡  (How)
â”œâ”€ ë‹¨ê³„ë³„ ì‹¤í–‰ ê°€ì´ë“œ
â”œâ”€ ì‹¤ì œ ì˜ˆì‹œ ìŠ¤í¬ë¦°ìƒ·
â””â”€ ì£¼ì˜ì‚¬í•­/íŒ

ì†Œì œëª© 3: ì‹¬í™”/ì‘ìš© (What)
â”œâ”€ ì¶”ê°€ í™œìš©ë²•
â”œâ”€ ë¹„êµ/ëŒ€ì•ˆ ì œì‹œ
â””â”€ FAQ í˜•ì‹ ì •ë¦¬

ë§ˆë¬´ë¦¬: ìš”ì•½ + í–‰ë™ ìœ ë„
â”œâ”€ í•µì‹¬ 3ì¤„ ìš”ì•½
â”œâ”€ ë‹¤ìŒ ì•¡ì…˜ ì œì•ˆ
â””â”€ ë”°ëœ»í•œ ì‘ì› ë©˜íŠ¸
\`\`\`

## ğŸ¨ ê°€ë…ì„± ê·¹ëŒ€í™” ê¸°ë²•

### 1. ë¬¸ë‹¨ ë¶„ë¦¬ ì›ì¹™
- 1ë¬¸ë‹¨ = 1ê°œ ì•„ì´ë””ì–´
- 3ì¤„ ì´ˆê³¼ ê¸ˆì§€ (ëª¨ë°”ì¼ ê¸°ì¤€)
- ë¬¸ë‹¨ ê°„ ë¹ˆ ì¤„ 1ê°œ í•„ìˆ˜

### 2. ì‹œê°ì  ìš”ì†Œ ë°°ì¹˜
**ì´ëª¨ì§€ í™œìš©:**
- ì œëª©ë§ˆë‹¤ 1ê°œ (ğŸ¯ ğŸ“Œ ğŸ’¡ âœ¨)
- ê°•ì¡° í¬ì¸íŠ¸ë§ˆë‹¤ 1ê°œ (âœ… âŒ ğŸ’° ğŸ”¥)
- ë‹¨, ê³¼ë„í•œ ì‚¬ìš©ì€ ì§€ì–‘ (5ë¬¸ì¥ë‹¹ 1ê°œ ê¼´)

**í…ìŠ¤íŠ¸ ê°•ì¡°:**
- **í•µì‹¬ í‚¤ì›Œë“œëŠ” ë³¼ë“œ**
- ìˆ«ì/ê³ ìœ ëª…ì‚¬ëŠ” ìë™ ì‹œì„  ì§‘ì¤‘
- ë°‘ì¤„(_)ì€ ìµœì†Œí™” (ê³¼í•˜ë©´ ì‚°ë§Œ)

### 3. ë¦¬ìŠ¤íŠ¸ ì „ëµ
**ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸ (ìˆœì„œ ì¤‘ìš”):**
1. ë‹¨ê³„ë³„ ì‹¤í–‰ë²•
2. ìˆœìœ„/ë­í‚¹
3. ì‹œê°„ìˆœ íë¦„

**ë¶ˆë¦¿ ë¦¬ìŠ¤íŠ¸ (ìˆœì„œ ë¬´ê´€):**
- íŠ¹ì§• ë‚˜ì—´
- ì¥ë‹¨ì  ë¹„êµ
- ì²´í¬ë¦¬ìŠ¤íŠ¸

**í‘œ í™œìš© (ë¹„êµ í•„ìˆ˜):**
| í•­ëª© | A | B |
|------|---|---|
| ê°€ê²© | 1ë§Œì› | 2ë§Œì› |

### 4. ì¸ìš©êµ¬ í™œìš©
> "ì‹¤ì œ ì‚¬ìš©ì í›„ê¸°ë‚˜ ì „ë¬¸ê°€ ì˜ê²¬ì„ ì¸ìš©êµ¬ë¡œ ì²˜ë¦¬í•˜ë©´ ì‹ ë¢°ë„ â¬†ï¸"

## ğŸ”— SEO ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸

### í‚¤ì›Œë“œ ë°°ì¹˜ ì „ëµ
- [ ] ì œëª©ì— ë©”ì¸ í‚¤ì›Œë“œ 1íšŒ (ì•ìª½ ë°°ì¹˜)
- [ ] ì²« ë¬¸ë‹¨ì— ë©”ì¸ í‚¤ì›Œë“œ 1íšŒ
- [ ] H2 ì†Œì œëª© ì¤‘ ìµœì†Œ 2ê°œì— í‚¤ì›Œë“œ ë³€í˜• í¬í•¨
- [ ] ë³¸ë¬¸ ì „ì²´ í‚¤ì›Œë“œ ë°€ë„ 2-3% ìœ ì§€
- [ ] ë§ˆì§€ë§‰ ë¬¸ë‹¨ì— í‚¤ì›Œë“œ ìì—°ìŠ¤ëŸ½ê²Œ 1íšŒ

### ë‚´ë¶€ ë§í¬ ì „ëµ (ì¤‘ìš”!)
- ê´€ë ¨ í¬ìŠ¤íŠ¸ ìµœì†Œ 2-3ê°œ ë§í¬
- ì•µì»¤ í…ìŠ¤íŠ¸ëŠ” í‚¤ì›Œë“œ í¬í•¨
- "ì´ì „ ê¸€ì—ì„œ ë‹¤ë¤˜ë˜ [í‚¤ì›Œë“œ ê´€ë ¨ ë‚´ìš©]ì„ ì°¸ê³ í•˜ì„¸ìš”"

### ì´ë¯¸ì§€ ìµœì í™”
- ëŒ€í‘œ ì´ë¯¸ì§€ 1ê°œ (ì¸ë„¤ì¼)
- ë³¸ë¬¸ ì´ë¯¸ì§€ 2-4ê°œ (ì„¤ëª…ë ¥ â¬†ï¸)
- ALT í…ìŠ¤íŠ¸ í•„ìˆ˜ (ì´ë¯¸ì§€ ì„¤ëª… + í‚¤ì›Œë“œ)

### ë©”íƒ€ë°ì´í„°
- ë©”íƒ€ ì œëª©: 55ì ì´ë‚´, í‚¤ì›Œë“œ ì•ìª½
- ë©”íƒ€ ì„¤ëª…: 120-155ì, í´ë¦­ ìœ ë„ ë¬¸êµ¬ í¬í•¨
`;

  const writingGuidelines = `
# ê¸€ì“°ê¸° ì„¸ë¶€ ê°€ì´ë“œ

## âœï¸ ë¬¸ì²´ ë° ì–´ì¡°

${input.tone ? `**ì§€ì •ëœ ë§íˆ¬:** "${input.tone}"` : `**ê¸°ë³¸ ë§íˆ¬:** ì¹œê·¼í•˜ê³  ì‹ ë¢°ê° ìˆëŠ” ì´ì›ƒ ê°™ì€ í†¤`}

### ë¬¸ì¥ êµ¬ì„± ì›ì¹™
- í‰ê·  ë¬¸ì¥ ê¸¸ì´: 15-25ì (ìµœëŒ€ 40ì)
- ëŠ¥ë™íƒœ ìš°ì„  (í”¼ë™íƒœ ìµœì†Œí™”)
- ì „ë¬¸ ìš©ì–´ëŠ” ì‰¬ìš´ ë§ë¡œ í’€ì–´ì“°ê¸°
- "~ê²ƒì´ë‹¤" ëŒ€ì‹  "~ë‹¤" (ê°„ê²°í•˜ê²Œ)

### í™•ì‹  ìˆëŠ” í‘œí˜„ ì‚¬ìš©
âŒ "~ê²ƒ ê°™ì•„ìš”", "ì•„ë§ˆë„", "~ì¸ ë“¯í•´ìš”"
âœ… "~ì…ë‹ˆë‹¤", "~í•´ìš”", "í™•ì‹¤íˆ ~í•©ë‹ˆë‹¤"

### ê°œì¸í™” & ìŠ¤í† ë¦¬í…”ë§
- "ì €ëŠ”", "ì œê°€ ê²½í—˜í•œ" ë“± 1ì¸ì¹­ ì‹œì 
- êµ¬ì²´ì  ìˆ«ì/ë‚ ì§œ ("ì‘ë…„ 3ì›”", "ì •í™•íˆ 27ì¼")
- Before & After ë¹„êµ

## ğŸ“Š ì‹ ë¢°ë„ ê°•í™” ìš”ì†Œ

1. **ë°ì´í„° ì¸ìš©**
   - "í†µê³„ì²­ ìë£Œì— ë”°ë¥´ë©´ ~"
   - "2024ë…„ ê¸°ì¤€ ~"

2. **ì „ë¬¸ê°€ ì˜ê²¬**
   - "â—‹â—‹ ì „ë¬¸ê°€ëŠ” ~ë¼ê³  ì¡°ì–¸í•©ë‹ˆë‹¤"

3. **ê°œì¸ ê²½í—˜ ì¦ëª…**
   - "ì§ì ‘ 3ê°œì›”ê°„ í…ŒìŠ¤íŠ¸í•œ ê²°ê³¼ ~"
   - "ì‹¤ì œ ì‚¬ìš© í›„ê¸°: ~"

4. **ë¹„êµ ë¶„ì„**
   - A vs B í‘œë¡œ ì •ë¦¬
   - ì¥ë‹¨ì  ëª…í™•íˆ êµ¬ë¶„

## ğŸš€ ëª°ì…ë„ ë†’ì´ëŠ” í…Œí¬ë‹‰

### 1. ì§ˆë¬¸ ë˜ì§€ê¸°
"í˜¹ì‹œ ì´ëŸ° ê²½í—˜ ìˆìœ¼ì‹ ê°€ìš”?"
"ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?"

### 2. ì˜ˆì‹œì˜ í˜
âŒ "íš¨ê³¼ê°€ ì¢‹ìŠµë‹ˆë‹¤"
âœ… "ì œ ê²½ìš° 7ì¼ ë§Œì— ë°©ë¬¸ì 200% ì¦ê°€í–ˆìŠµë‹ˆë‹¤"

### 3. ë…ì ì°¸ì—¬ ìœ ë„
"ëŒ“ê¸€ë¡œ ì—¬ëŸ¬ë¶„ì˜ ê²½í—˜ë„ ê³µìœ í•´ì£¼ì„¸ìš”!"
"ì´ ë°©ë²• ì¤‘ ì–´ë–¤ ê²Œ ê°€ì¥ ëŒë¦¬ë‚˜ìš”?"

## âš ï¸ í”¼í•´ì•¼ í•  ê²ƒë“¤

âŒ ì§€ì–‘í•´ì•¼ í•  í‘œí˜„:
- ê³¼ë„í•œ ìˆ˜ì‹ì–´ ("ì •ë§ì •ë§ì •ë§")
- ê´‘ê³ ì„± ë©˜íŠ¸ ("ì§€ê¸ˆ ë°”ë¡œ í´ë¦­!")
- ëª¨í˜¸í•œ í‘œí˜„ ("ë‹¤ì–‘í•œ", "ì—¬ëŸ¬ ê°€ì§€")
- ë„ˆë¬´ ë”±ë”±í•œ ê²©ì‹ì²´

âŒ êµ¬ì¡°ì  ì‹¤ìˆ˜:
- ì„œë¡ ì´ ë„ˆë¬´ ê¹€ (3ë¬¸ë‹¨ ì´ˆê³¼)
- ì†Œì œëª© ì—†ì´ ê¸´ í…ìŠ¤íŠ¸ ë©ì–´ë¦¬
- ê²°ë¡  ì—†ì´ ê°‘ìê¸° ëë‚¨
- ë‹¨ì¡°ë¡œìš´ ë¬¸ì¥ êµ¬ì¡° ë°˜ë³µ
`;

  const lengthInstruction = input.textLength
    ? `
## ğŸ“ ê¸€ ë¶„ëŸ‰ ê·œì¹™ (ì—„ê²©íˆ ì¤€ìˆ˜)
- **ìµœì†Œ:** ${input.textLength.min}ì (ê³µë°± í¬í•¨)
- **ìµœëŒ€:** ${input.textLength.max}ì (ê³µë°± í¬í•¨)
- **ì¸¡ì • ë°©ë²•:** ìµœì¢… ë§ˆí¬ë‹¤ìš´ ì „ì²´ í…ìŠ¤íŠ¸ ê¸°ì¤€
- **ì´ˆê³¼/ë¯¸ë‹¬ ì‹œ:** ìë™ ì¡°ì ˆí•˜ì—¬ ë²”ìœ„ ë‚´ë¡œ ë§ì¶¤

ğŸ’¡ TIP: ${input.textLength.min}ì ì´ìƒì„ ì±„ìš°ë ¤ë©´ êµ¬ì²´ì  ì˜ˆì‹œ, ë°ì´í„°, ê²½í—˜ë‹´ì„ ì¶”ê°€í•˜ì„¸ìš”.
`
    : `
## ğŸ“ ê¸€ ë¶„ëŸ‰ ê°€ì´ë“œ
- **ìµœì†Œ ê¶Œì¥:** 1,500ì (ê²€ìƒ‰ ë…¸ì¶œ ìµœì†Œ ê¸°ì¤€)
- **ì´ìƒì :** 2,000-3,000ì (ìƒìœ„ ë…¸ì¶œ êµ¬ê°„)
- **ì „ë¬¸ ì½˜í…ì¸ :** 4,000ì ì´ìƒ (ì „ë¬¸ì„± ì¸ì •)
`;

  const sectionInstruction = input.sections
    ? `
## ğŸ“‘ ëª©ì°¨ êµ¬ì„±
- **ì†Œì œëª©(H2) ê°œìˆ˜:** ì •í™•íˆ ${input.sections}ê°œ
- **ê° ì„¹ì…˜ ë¶„ëŸ‰:** ê· ë“±í•˜ê²Œ ë°°ë¶„
- **ìˆœì„œ:** ë…¼ë¦¬ì  íë¦„ (ì¼ë°˜â†’êµ¬ì²´, ì´ë¡ â†’ì‹¤ì „)
`
    : `
## ğŸ“‘ ëª©ì°¨ êµ¬ì„±
- **ì†Œì œëª©(H2) ê°œìˆ˜:** 3-5ê°œ ê¶Œì¥
- **êµ¬ì„± ì˜ˆì‹œ:** ê°œë… ì„¤ëª… â†’ ì‹¤ì „ ë°©ë²• â†’ ì‚¬ë¡€/ë¹„êµ â†’ FAQ â†’ ê²°ë¡ 
`;

  const finalPrompt = `
${systemRole}

${contextAnalysis}

${contentStructure}

${writingGuidelines}

${lengthInstruction}

${sectionInstruction}

---

# ğŸ¯ ìµœì¢… ì‘ì„± ë¯¸ì…˜

ìœ„ ëª¨ë“  ê°€ì´ë“œë¥¼ ì¢…í•©í•˜ì—¬, "${input.topic}" ì£¼ì œë¡œ **ê²€ìƒ‰ ìƒìœ„ ë…¸ì¶œ ê°€ëŠ¥í•œ ìµœê³  í’ˆì§ˆì˜ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸**ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

## ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì‘ì„± ì „ í•„ìˆ˜ í™•ì¸)
- [ ] ì œëª©ì— ë©”ì¸ í‚¤ì›Œë“œ í¬í•¨ + ìˆ«ì/ì—°ë„ í™œìš©
- [ ] ì²« 3ë¬¸ì¥ì—ì„œ ë…ì ì‚¬ë¡œì¡ê¸°
- [ ] ì†Œì œëª© ${input.sections || "3-5"}ê°œ êµ¬ì„±
- [ ] ë¬¸ë‹¨ë‹¹ ìµœëŒ€ 3ì¤„
- [ ] ì´ëª¨ì§€ ì ì ˆíˆ ë°°ì¹˜ (ê³¼í•˜ì§€ ì•Šê²Œ)
- [ ] ë³¼ë“œ/ë¦¬ìŠ¤íŠ¸ë¡œ ì‹œê°ì  êµ¬ì¡°í™”
- [ ] ê°œì¸ ê²½í—˜/ë°ì´í„° ìµœì†Œ 2ê³³ ì‚½ì…
- [ ] ë‚´ë¶€ ë§í¬ í¬ì¸íŠ¸ í‘œì‹œ
- [ ] ë§ˆë¬´ë¦¬ì— ìš”ì•½ + í–‰ë™ ìœ ë„
- [ ] ê¸€ììˆ˜ ${input.textLength ? `${input.textLength.min}-${input.textLength.max}ì` : "2,000ì ì´ìƒ"}

## ì¶œë ¥ í˜•ì‹ (JSONë§Œ ì¶œë ¥, ë§ˆí¬ë‹¤ìš´ ì½”ë“œë¸”ë¡ ì‚¬ìš© ê¸ˆì§€)
**ì£¼ì˜ì‚¬í•­:**
1. \`\`\`json ì½”ë“œ ë¸”ë¡ì„ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
2. ìˆœìˆ˜ JSON ë¬¸ìì—´ë§Œ ë°˜í™˜í•˜ì„¸ìš”.
3. ì¤„ë°”ê¿ˆì€ ë°˜ë“œì‹œ \\n ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬í•˜ì„¸ìš”.

{
  "title": "SEO ìµœì í™”ëœ ì œëª© (ì´ëª¨ì§€ í¬í•¨)",
  "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3"],
  "content": "ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ì „ì²´ ë³¸ë¬¸ (ì œëª© ì œì™¸). ì¤„ë°”ê¿ˆì€ \\n ì‚¬ìš©.",
  "metaTitle": "SEO ë©”íƒ€ ì œëª© (55ì ì´ë‚´, í‚¤ì›Œë“œ í¬í•¨)",
  "metaDescription": "SEO ë©”íƒ€ ì„¤ëª… (150ì ì´ë‚´)",
  "focusKeywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2", "í‚¤ì›Œë“œ3"],
  "internalLinkSuggestions": [
    {
      "anchor": "ì•µì»¤ í…ìŠ¤íŠ¸",
      "context": "ì‚½ì… ìœ„ì¹˜ ì„¤ëª…"
    }
  ],
  "imageAltTexts": [
    "ëŒ€í‘œ ì´ë¯¸ì§€ ALT í…ìŠ¤íŠ¸ (í‚¤ì›Œë“œ í¬í•¨)",
    "ë³¸ë¬¸ ì´ë¯¸ì§€1 ALT í…ìŠ¤íŠ¸"
  ]
}

---

**ğŸš€ ì§€ê¸ˆ ë°”ë¡œ ì‘ì„±ì„ ì‹œì‘í•˜ì„¸ìš”!**
`;

  // 1ë‹¨ê³„: ë©”ì¸ ì½˜í…ì¸  ìƒì„±
  const mainPost = await safeGenerate(() =>
    client.generateJson<AiGeneratedPost>(finalPrompt),
  );

  return mainPost;
};

/**
 * ìƒì„±ëœ ì½˜í…ì¸ ì˜ í’ˆì§ˆ ê²€ì¦
 */
export const validatePostQuality = (
  post: AiGeneratedPost,
  input: BlogPostInput,
): { isValid: boolean; errors: string[] } => {
  const errors: string[] = [];

  // ê¸€ììˆ˜ ì²´í¬
  if (input.textLength) {
    const contentLength = post.content.length;
    if (contentLength < input.textLength.min) {
      errors.push(
        `ê¸€ììˆ˜ ë¶€ì¡±: ${contentLength}ì (ìµœì†Œ ${input.textLength.min}ì)`,
      );
    }
    if (contentLength > input.textLength.max) {
      errors.push(
        `ê¸€ììˆ˜ ì´ˆê³¼: ${contentLength}ì (ìµœëŒ€ ${input.textLength.max}ì)`,
      );
    }
  }

  // ì†Œì œëª© ê°œìˆ˜ ì²´í¬
  if (input.sections) {
    const h2Count = (post.content.match(/^## /gm) || []).length;
    if (h2Count !== input.sections) {
      errors.push(
        `ì†Œì œëª© ê°œìˆ˜ ë¶ˆì¼ì¹˜: ${h2Count}ê°œ (ìš”êµ¬ ${input.sections}ê°œ)`,
      );
    }
  }

  // ì œëª© ê¸¸ì´ ì²´í¬
  if (post.title.length > 60) {
    errors.push(`ì œëª© ë„ˆë¬´ ê¹€: ${post.title.length}ì (ê¶Œì¥ 60ì ì´ë‚´)`);
  }

  // ë©”íƒ€ ì„¤ëª… ì²´í¬
  if (post.metaDescription && post.metaDescription.length > 160) {
    errors.push(
      `ë©”íƒ€ ì„¤ëª… ë„ˆë¬´ ê¹€: ${post.metaDescription.length}ì (ìµœëŒ€ 160ì)`,
    );
  }

  return {
    isValid: errors.length === 0,
    errors,
  };
};

// import { BaseAiClient } from "../ai";
// import { BlogPostInput, AiGeneratedPost } from "../types/blog";
// import { safeGenerate } from "../util/safeGenerate";

// export const generatePostSingleCall = async (
//   client: BaseAiClient,
//   input: BlogPostInput,
// ): Promise<AiGeneratedPost> => {
//   const role = `
// ë„ˆëŠ” ë¸”ë¡œê·¸ ìƒìœ„ ë…¸ì¶œì„ ì „ë¬¸ìœ¼ë¡œ í•˜ëŠ” ì½˜í…ì¸  ì „ëµê°€ë‹¤.
// ê²€ìƒ‰ ì˜ë„ë¥¼ ì •í™•íˆ ë°˜ì˜í•˜ê³ ,
// ë¶ˆí•„ìš”í•œ ìˆ˜ì‹ì–´ëŠ” ì¤„ì´ë©°,
// ì‹¤ì œ ê²€ìƒ‰ ì‚¬ìš©ìì—ê²Œ ë„ì›€ì´ ë˜ëŠ” ì •ë³´ë§Œ ì‘ì„±í•œë‹¤.
//  ë…ìê°€ ëê¹Œì§€ ì½ê²Œ ë§Œë“œëŠ” ëª°ì…ê° ìˆëŠ” ë¬¸ì²´ì™€, ê²€ìƒ‰ ì—”ì§„ì— ìµœì í™”ëœ(SEO) êµ¬ì¡°ë¡œ ê¸€ì„ ì“°ëŠ” ë° ì²œì¬ì ì´ì•¼.
//  ì ì ˆí•œ ì´ëª¨ì§€ì™€ ê°€ë…ì„± ë†’ì€ ë¬¸ë‹¨ êµ¬ì„±ì„ í†µí•´ ì‹œê°ì ìœ¼ë¡œ ë§¤ë ¥ì ì¸ ê¸€ì„ ì‘ì„±í•œë‹¤.
// `;

//   const toneInstruction = input.tone
//     ? `ë§íˆ¬ëŠ” "${input.tone}" ìŠ¤íƒ€ì¼ë¡œ ì‘ì„±í•œë‹¤.`
//     : "";

//   const lengthInstruction = input.textLength
//     ? `
// [ê¸€ ë¶„ëŸ‰ ì¡°ê±´]
// - ìµœì¢… ê²°ê³¼ë¬¼ì€ ê³µë°± í¬í•¨ ${input.textLength.min}ì ì´ìƒ ${input.textLength.max}ì ì´í•˜ë¡œ ì‘ì„±í•œë‹¤.
// - ì´ ì¡°ê±´ì€ ë°˜ë“œì‹œ ì§€í‚¨ë‹¤.
// `
//     : "";

//   const sectionInstruction = input.sections
//     ? `ì†Œì œëª© ê°œìˆ˜ëŠ” ì •í™•íˆ ${input.sections}ê°œë¡œ êµ¬ì„±í•œë‹¤.`
//     : "";

//   const prompt = `
// ${role}

// [ì£¼ì œ]
// "${input.topic}"

// ${toneInstruction}
// ${lengthInstruction}
// ${sectionInstruction}

// [ì‘ì„± ê·œì¹™]
// - **ì´ëª¨ì§€ í•„ìˆ˜ ì‚¬ìš©**: ì œëª©, ì†Œì œëª©, ê·¸ë¦¬ê³  ê° ë¬¸ë‹¨ì˜ ì²« ì‹œì‘ì´ë‚˜ ê°•ì¡°í•  ë•Œ ì´ëª¨ì§€(âœ¨, ğŸ’¡, âœˆï¸, ğŸ’, âœ… ë“±)ë¥¼ í’ë¶€í•˜ê²Œ ì‚¬ìš©í•˜ì—¬ ì‹œê°ì ì¸ ì¦ê±°ì›€ì„ ì¤€ë‹¤. ìµœì†Œ 5ë¬¸ì¥ë§ˆë‹¤ 1ê°œ ì´ìƒì˜ ì´ëª¨ì§€ë¥¼ í¬í•¨í•  ê²ƒ.
// - **ë¬¸ë‹¨ ë° ê°€ë…ì„±**:
//   - í•œ ë¬¸ë‹¨ì€ ìµœëŒ€ 3ì¤„ì„ ë„˜ê¸°ì§€ ì•ŠëŠ”ë‹¤.
//   - ë¬¸ë‹¨ê³¼ ë¬¸ë‹¨ ì‚¬ì´ëŠ” í™•ì‹¤í•˜ê²Œ ì¤„ë°”ê¿ˆì„ í•œë‹¤.
//   - ì¤‘ìš”í•œ ë‹¨ì–´ë‚˜ ë¬¸ì¥ì€ **êµµê²Œ(Bold)** í‘œì‹œí•˜ì—¬ ëˆˆì— ë„ê²Œ í•œë‹¤.
//   - ë¦¬ìŠ¤íŠ¸(1., -)ì™€ ì¸ìš©êµ¬(>)ë¥¼ ì ê·¹ í™œìš©í•˜ì—¬ í…ìŠ¤íŠ¸ ë©ì–´ë¦¬ë¥¼ ê¹¬ë‹¤.
// - **ë‚´ìš© ì „ê°œ**:
//   - **ë„ì…ë¶€**: "í˜¹ì‹œ ì´ëŸ° ê³ ë¯¼ í•˜ì…¨ë‚˜ìš”?"ì™€ ê°™ì´ ë…ìì˜ ìƒí™©ì„ ê¿°ëš«ëŠ” ì§ˆë¬¸ìœ¼ë¡œ ì‹œì‘ (3ì´ˆ ì•ˆì— ì‚¬ë¡œì¡ê¸°).
//   - **ë³¸ë¬¸**: êµ¬ì²´ì ì¸ ì´ìœ ì™€ í•´ê²°ì±… ì œì‹œ. ë‹¨ìˆœíˆ "ì¢‹ë‹¤"ê°€ ì•„ë‹ˆë¼ "ì™œ ì¢‹ì€ì§€" ê²½í—˜ì— ë¹—ëŒ€ì–´ ì„¤ëª… ("ì œê°€ ì§ì ‘ ì¨ë³´ë‹ˆ~").
//   - **ë§ˆë¬´ë¦¬**: ìš”ì•½ ë° ë”°ëœ»í•œ ì‘ì›.
// - **ì–´ì¡°**: ì¹œê·¼í•œ ì˜†ì§‘ ì–¸ë‹ˆ/ì˜¤ë¹ ê°€ ì•Œë ¤ì£¼ëŠ” ë“¯í•œ ë‹¤ì •í•˜ê³  ì‹ ë¢°ê° ìˆëŠ” ë§íˆ¬ ("~í•´ìš”", "~ëë‹ˆë‹¤", "~ê±°ë“ ìš”"). í™•ì‹  ìˆëŠ” ì–´ì¡° ì‚¬ìš©.

// [ì¶œë ¥ í˜•ì‹(JSON)]
// **ì¤‘ìš”: ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡(\`\`\`json)ì„ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì‹œì˜¤. ì˜¤ì§ JSON ë¬¸ìì—´ë§Œ ì¶œë ¥í•˜ì‹œì˜¤.**
// {
//   "title": "ì œëª© (ë§¤ë ¥ì ì¸ ì´ëª¨ì§€ í¬í•¨)",
//   "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3"],
//   "content": "ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ì „ì²´ ë³¸ë¬¸"
// }
// `;

//   const response = await safeGenerate(() =>
//     client.generateJson<AiGeneratedPost>(prompt),
//   );

//   return response;
// };
