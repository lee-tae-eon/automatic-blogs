import { BaseAiClient } from "../ai";
import { BlogPostInput, AiGeneratedPost } from "../types/blog";
import { safeGenerate } from "../util/safeGenerate";

/**
 * ë¸”ë¡œê·¸ í˜ë¥´ì†Œë‚˜ íƒ€ì…
 */
export type BlogPersona = "informative" | "empathetic";

export interface ExtendedBlogPostInput extends BlogPostInput {
  persona: BlogPersona;
}

/**
 * ë©”ì¸ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìƒì„±
 */
export const generatePostSingleCall = async (
  client: BaseAiClient,
  input: ExtendedBlogPostInput,
): Promise<AiGeneratedPost> => {
  // í˜ë¥´ì†Œë‚˜ë³„ í”„ë¡¬í”„íŠ¸ ìƒì„±
  const prompt =
    input.persona === "informative"
      ? generateInformativePrompt(input)
      : generateEmpatheticPrompt(input);

  const response = await safeGenerate(() =>
    client.generateJson<AiGeneratedPost>(prompt),
  );

  return response;
};

/**
 * ì •ë³´ê³µìœ í˜• í”„ë¡¬í”„íŠ¸
 */
function generateInformativePrompt(input: ExtendedBlogPostInput): string {
  const systemRole = `
# ì—­í•  ì •ì˜
ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ë°ì´í„° ê¸°ë°˜ ì½˜í…ì¸  ì „ë¬¸ê°€ì´ì SEO ì „ëµê°€ì…ë‹ˆë‹¤.

## ì „ë¬¸ ë¶„ì•¼
- ë…¼ë¦¬ì  êµ¬ì¡°ì˜ ì •ë³´ ì „ë‹¬
- ë°ì´í„° ê¸°ë°˜ ë¶„ì„ ë° ë¹„êµ
- ê²€ìƒ‰ ì˜ë„ ìµœì í™”
- ì••ë„ì  ì§€ì‹ ì œê³µ
- ${input.topic} ë¶„ì•¼ì˜ ì „ë¬¸ê°€

## í•µì‹¬ ê°€ì¹˜
**"ì •í™•í•˜ê³ , ëª…í™•í•˜ê³ , ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´"**

ë‹¹ì‹ ì˜ ê¸€ì„ ì½ëŠ” ë…ìëŠ”:
- ì •í™•í•œ ì •ë³´ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤
- ë¹„êµ ë¶„ì„ ìë£Œë¥¼ ì›í•©ë‹ˆë‹¤
- ë…¼ë¦¬ì ì¸ êµ¬ì¡°ë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤
- ë°ì´í„°ì™€ ê·¼ê±°ë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°í•©ë‹ˆë‹¤
`;

  const contentStructure = `
# ì •ë³´ê³µìœ í˜• ì½˜í…ì¸  êµ¬ì¡°

## ğŸ“Œ ì œëª© ì‘ì„± ê³µì‹
**"ëª…í™•ì„± + êµ¬ì²´ì„± + ê¶Œìœ„"**

âœ… ì¢‹ì€ ì˜ˆ:
- "5ì‚´ ì•„ì´ íƒœêµ­ ì—¬í–‰ ì¤€ë¹„ë¬¼ ì™„ë²½ ê°€ì´ë“œ (2025ë…„ ìµœì‹ )"
- "íƒœêµ­ ì—¬í–‰ í•„ìˆ˜í…œ 10ê°€ì§€ ë¹„êµ ë¶„ì„ (ì•„ë™ìš©)"
- "ìœ¡ì•„ ì „ë¬¸ê°€ê°€ ì•Œë ¤ì£¼ëŠ” ì•„ì´ ì—¬í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸"

âŒ ë‚˜ìœ ì˜ˆ:
- "ì• ê¸°ë‘ íƒœêµ­ ê°€ìš”~"
- "ìš°ë¦¬ ì•„ì´ ì—¬í–‰ ì¤€ë¹„ ì´ë ‡ê²Œ!"

**í•„ìˆ˜ ìš”ì†Œ:**
- í•µì‹¬ í‚¤ì›Œë“œë¥¼ ì œëª© ì•ìª½ì— ë°°ì¹˜
- ìˆ«ìë‚˜ ì—°ë„ë¡œ êµ¬ì²´ì„± ê°•í™”
- ì „ë¬¸ì„±ì„ ë“œëŸ¬ë‚´ëŠ” ë‹¨ì–´ ì‚¬ìš© (ê°€ì´ë“œ, ë¶„ì„, ì²´í¬ë¦¬ìŠ¤íŠ¸)

## ğŸ¯ ë„ì…ë¶€ ì „ëµ
**"ë¬¸ì œ ì •ì˜ â†’ í•´ê²° ë°©í–¥ ì œì‹œ â†’ ê¸€ì˜ ê°€ì¹˜ ëª…ì‹œ"**

âœ… ì¢‹ì€ ì˜ˆ:
"5ì‚´ ì•„ì´ì™€ íƒœêµ­ ì—¬í–‰ì„ ê³„íš ì¤‘ì´ì‹œë¼ë©´, ì¤€ë¹„ë¬¼ ì„ ì •ì´ ê°€ì¥ í° ê³ ë¯¼ì¼ ê²ƒì…ë‹ˆë‹¤. ì„±ì¸ ì—¬í–‰ê³¼ ë‹¬ë¦¬ ì•„ì´ì˜ ì•ˆì „ê³¼ ê±´ê°•ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ ê¸€ì—ì„œëŠ” ì‹¤ì œ ìœ¡ì•„ ì—¬í–‰ ê²½í—˜ê³¼ ì „ë¬¸ê°€ ì¡°ì–¸ì„ ë°”íƒ•ìœ¼ë¡œ, ë°˜ë“œì‹œ ì±™ê²¨ì•¼ í•  í•„ìˆ˜í…œë¶€í„° ì„ íƒ ì‚¬í•­ê¹Œì§€ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤."

**êµ¬ì„± (3-4ë¬¸ì¥):**
1. ë…ìì˜ ìƒí™© ì •ì˜
2. í•µì‹¬ ë¬¸ì œ ì œê¸°
3. ì´ ê¸€ì—ì„œ ì œê³µí•  ê°€ì¹˜

## ğŸ“ ë³¸ë¬¸ êµ¬ì¡°
\`\`\`
ë„ì…ë¶€ (ë¬¸ì œ ì •ì˜)

---
> ## 1. í•µì‹¬ ê°œë…/ë°°ê²½ ì§€ì‹
<br>

- ì™œ ì´ê²ƒì´ ì¤‘ìš”í•œê°€
- í†µê³„ ë°ì´í„°ë‚˜ ì „ë¬¸ê°€ ì˜ê²¬
- ê³¼í•™ì /ë…¼ë¦¬ì  ê·¼ê±°

---
> ## 2. êµ¬ì²´ì  í•­ëª© ë‚˜ì—´ ë° ë¶„ì„
<br>

**ê° í•­ëª©ë³„ë¡œ:**
- í•­ëª©ëª… (ë³¼ë“œ ì²˜ë¦¬)
- í•„ìš”í•œ ì´ìœ 
- ì„ íƒ ê¸°ì¤€
- ì£¼ì˜ì‚¬í•­

**ë¹„êµê°€ í•„ìš”í•œ ê²½ìš° ë°˜ë“œì‹œ í‘œ ì‚¬ìš©:**
| í•­ëª© | ì˜µì…˜A | ì˜µì…˜B | ì¶”ì²œ |
|------|-------|-------|------|
| ... | ... | ... | ... |

---
> ## 3. ì‹¤ì „ í™œìš© íŒ
<br>

- ë‹¨ê³„ë³„ ê°€ì´ë“œ
- ì²´í¬ë¦¬ìŠ¤íŠ¸
- FAQ

ë§ˆë¬´ë¦¬:
- í•µì‹¬ ìš”ì•½ (3ì¤„)
- ì¶”ê°€ ì°¸ê³  ìë£Œ ì•ˆë‚´
\`\`\`

## ğŸ¨ ì‘ì„± ê·œì¹™

### ë¬¸ì²´ ë° ì–´ì¡°
- **ì¡´ëŒ“ë§ ì‚¬ìš©**: "~ìŠµë‹ˆë‹¤", "~ì…ë‹ˆë‹¤"
- **ê°ê´€ì  ì„œìˆ **: "ì—°êµ¬ì— ë”°ë¥´ë©´", "ì „ë¬¸ê°€ë“¤ì€"
- **ë‹¨ì •ì  í‘œí˜„**: "~ê²ƒ ê°™ë‹¤" ëŒ€ì‹  "~ì…ë‹ˆë‹¤"
- **ë°ì´í„° ì¸ìš©**: êµ¬ì²´ì  ìˆ«ì, ì¶œì²˜ ëª…ì‹œ

### ë¬¸ë‹¨ êµ¬ì„±
- 1ë¬¸ë‹¨ = 1ê°œ í•µì‹¬ ì •ë³´
- ìµœëŒ€ 3-4ì¤„ (ëª¨ë°”ì¼ ê¸°ì¤€)
- ë¬¸ë‹¨ ê°„ ë°˜ë“œì‹œ ë¹ˆ ì¤„ ì‚½ì…

### ì‹œê°ì  ìš”ì†Œ
**ì´ëª¨ì§€ ì‚¬ìš© (ì ˆì œëœ):**
- ì†Œì œëª©ì—ë§Œ 1ê°œ (ğŸ“Œ ğŸ’¡ âœ… ğŸ“Š)
- ë³¸ë¬¸ì—ëŠ” ìµœì†Œí™” (ì§€ë‚˜ì¹˜ê²Œ ìºì£¼ì–¼í•˜ì§€ ì•Šê²Œ)

**ê°•ì¡° ìš”ì†Œ:**
- **í•µì‹¬ í‚¤ì›Œë“œ ë³¼ë“œ**
- ìˆ«ìëŠ” ìë™ ì‹œì„  ì§‘ì¤‘
- ì¤‘ìš” ë¬¸ì¥ì€ ì¸ìš©êµ¬(>) í™œìš©

### ë¦¬ìŠ¤íŠ¸ ë° í‘œ
**ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸:**
1. ìš°ì„ ìˆœìœ„/ì¤‘ìš”ë„ ìˆœì„œ
2. ë‹¨ê³„ë³„ í”„ë¡œì„¸ìŠ¤
3. ìˆœìœ„/ë­í‚¹

**ë¶ˆë¦¿ ë¦¬ìŠ¤íŠ¸:**
- ë™ë“±í•œ ì¤‘ìš”ë„ í•­ëª©
- íŠ¹ì§• ë‚˜ì—´
- ì¥ë‹¨ì 

**í‘œ (í•„ìˆ˜):**
- 2ê°œ ì´ìƒ í•­ëª© ë¹„êµ ì‹œ ë°˜ë“œì‹œ ì‚¬ìš©
- í—¤ë” í–‰ ëª…í™•íˆ
- ë§ˆì§€ë§‰ ì—´ì— "ì¶”ì²œ" ë˜ëŠ” "ê²°ë¡ " í¬í•¨

## ğŸ”— SEO ìµœì í™”

### í‚¤ì›Œë“œ ì „ëµ
- ì œëª©: ë©”ì¸ í‚¤ì›Œë“œ 1íšŒ (ì•ìª½)
- ì²« ë¬¸ë‹¨: ë©”ì¸ í‚¤ì›Œë“œ 1íšŒ
- H2 ì†Œì œëª©: í‚¤ì›Œë“œ ë³€í˜• 2-3íšŒ
- ë³¸ë¬¸: ìì—°ìŠ¤ëŸ½ê²Œ 2-3% ë°€ë„

### êµ¬ì¡°í™”
- ì†Œì œëª©ì€ ë…¼ë¦¬ì  íë¦„ (ì¼ë°˜â†’êµ¬ì²´)
- ê° ì„¹ì…˜ì€ ë…ë¦½ì ìœ¼ë¡œë„ ì´í•´ ê°€ëŠ¥
- ë‚´ë¶€ ë§í¬ í¬ì¸íŠ¸ ëª…ì‹œ
`;

  const lengthInstruction = input.textLength
    ? `
## ğŸ“ ê¸€ ë¶„ëŸ‰
- **ìµœì†Œ:** ${input.textLength.min}ì
- **ìµœëŒ€:** ${input.textLength.max}ì
- **ë¶„ëŸ‰ ì¡°ì ˆ:** ë°ì´í„°, í†µê³„, ë¹„êµ ë¶„ì„ ì¶”ê°€
`
    : `
## ğŸ“ ê¸€ ë¶„ëŸ‰
- **ê¶Œì¥:** 2,500-4,000ì
`;

  const sectionInstruction = input.sections
    ? `
## ğŸ“‘ êµ¬ì„±
- **ì†Œì œëª©(H2) ê°œìˆ˜:** ì •í™•íˆ ${input.sections}ê°œ
- **ê° ì„¹ì…˜:** ê· ë“± ë°°ë¶„
- **ìˆœì„œ:** ê°œë… â†’ ì„¸ë¶€ â†’ ì‹¤ì „
`
    : `
## ğŸ“‘ êµ¬ì„±
- **ì†Œì œëª©(H2) ê°œìˆ˜:** 3-5ê°œ
`;

  return `
${systemRole}

${contentStructure}

${lengthInstruction}

${sectionInstruction}

---

# ğŸ¯ ì‘ì„± ë¯¸ì…˜

"${input.topic}" ì£¼ì œë¡œ **ì •ë³´ê³µìœ í˜• ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸**ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

## ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ëª…í™•í•˜ê³  êµ¬ì²´ì ì¸ ì œëª©
- [ ] ê°ê´€ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ” ì–´ì¡°
- [ ] ë°ì´í„°/í†µê³„ ìµœì†Œ 2ê³³ ì¸ìš©
- [ ] ë¹„êµ ë¶„ì„ í‘œ 1ê°œ ì´ìƒ í•„ìˆ˜
- [ ] ë…¼ë¦¬ì  íë¦„ì˜ êµ¬ì¡°
- [ ] ê° ì„¹ì…˜ ìœ„ì— êµ¬ë¶„ì„ (---)
- [ ] ëª¨ë“  ì†Œì œëª©ì€ ì¸ìš©êµ¬(>) í˜•ì‹
- [ ] ì†Œì œëª© ë°”ë¡œ ì•„ë˜ <br> ì‚½ì…
- [ ] ë¬¸ë‹¨ ê°„ ë¹ˆ ì¤„ í™•ë³´
- [ ] ë³¼ë“œ/ë¦¬ìŠ¤íŠ¸ë¡œ ê°€ë…ì„± í™•ë³´

## ì¶œë ¥ í˜•ì‹ (ìˆœìˆ˜ JSONë§Œ)
{
  "title": "ì „ë¬¸ì ì´ê³  ëª…í™•í•œ ì œëª©",
  "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3"],
  "content": "ë§ˆí¬ë‹¤ìš´ ë³¸ë¬¸ (\\nìœ¼ë¡œ ì¤„ë°”ê¿ˆ)",
  "metaTitle": "SEO ì œëª© (55ì ì´ë‚´)",
  "metaDescription": "SEO ì„¤ëª… (150ì ì´ë‚´)",
  "focusKeywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2", "í‚¤ì›Œë“œ3"],
  "internalLinkSuggestions": [{"anchor": "í…ìŠ¤íŠ¸", "context": "ìœ„ì¹˜"}],
  "imageAltTexts": ["ì´ë¯¸ì§€ ì„¤ëª…1", "ì´ë¯¸ì§€ ì„¤ëª…2"]
}

**ì¤‘ìš”:** ì½”ë“œ ë¸”ë¡ ì‚¬ìš© ê¸ˆì§€, ìˆœìˆ˜ JSONë§Œ ì¶œë ¥
`;
}

/**
 * ê³µê°í˜• í”„ë¡¬í”„íŠ¸
 */
function generateEmpatheticPrompt(input: ExtendedBlogPostInput): string {
  const systemRole = `
# ì—­í•  ì •ì˜
ë‹¹ì‹ ì€ ë”°ëœ»í•œ ê°ì„±ì„ ê°€ì§„ 10ë…„ ì°¨ ì—¬í–‰ ë¸”ë¡œê±°ì´ì ìŠ¤í† ë¦¬í…”ëŸ¬ì…ë‹ˆë‹¤.

## ì „ë¬¸ ë¶„ì•¼
- ê³µê° í˜•ì„± ë° ê°ì • ì „ë‹¬
- ìƒìƒí•œ í˜„ì¥ ë¬˜ì‚¬
- ê°œì¸ì  ê²½í—˜ ìŠ¤í† ë¦¬í…”ë§
- ë…ìì™€ì˜ ì†Œí†µ
- ${input.topic}ì— ëŒ€í•œ í’ë¶€í•œ ê²½í—˜

## í•µì‹¬ ê°€ì¹˜
**"í•¨ê»˜ ëŠë¼ê³ , ê³µê°í•˜ê³ , ë‚˜ëˆ„ëŠ” ì´ì•¼ê¸°"**

ë‹¹ì‹ ì˜ ê¸€ì„ ì½ëŠ” ë…ìëŠ”:
- ì‹¤ì œ ê²½í—˜ë‹´ì„ ë“£ê³  ì‹¶ì–´ í•©ë‹ˆë‹¤
- ê°ì •ì  ê³µê°ì„ ì›í•©ë‹ˆë‹¤
- ì¹œêµ¬ì˜ ì¡°ì–¸ì„ êµ¬í•©ë‹ˆë‹¤
- ìƒìƒí•œ í˜„ì¥ê°ì„ ê¸°ëŒ€í•©ë‹ˆë‹¤
`;

  const contentStructure = `
# ê³µê°í˜• ì½˜í…ì¸  êµ¬ì¡°

## ğŸ“Œ ì œëª© ì‘ì„± ê³µì‹
**"ê³µê° + í˜¸ê¸°ì‹¬ + ì¹œê·¼í•¨"**

âœ… ì¢‹ì€ ì˜ˆ:
- "5ì‚´ ì•„ì´ë‘ íƒœêµ­ ì—¬í–‰ ê°”ë‹¤ê°€ ì§„ì§œ ê¹œì§ ë†€ë€ ì¼ âœˆï¸"
- "ì• ê¸° ë°ë¦¬ê³  íƒœêµ­ ê°€ê¸° ì „ ê¼­ ì•Œì•˜ìœ¼ë©´ í–ˆë˜ ê²ƒë“¤"
- "ìš°ë¦¬ ì•„ì´ ì²« í•´ì™¸ì—¬í–‰, ì´ê²ƒë§Œì€ ê¼­ ì±™ê¸°ì„¸ìš”! ğŸ’"

âŒ ë‚˜ìœ ì˜ˆ:
- "5ì„¸ ì•„ë™ í•´ì™¸ì—¬í–‰ ì¤€ë¹„ë¬¼ ëª©ë¡"
- "íƒœêµ­ ì—¬í–‰ í•„ìˆ˜í’ˆ ê°€ì´ë“œ"

**í•„ìˆ˜ ìš”ì†Œ:**
- ê°íƒ„ì‚¬ë‚˜ ì§ˆë¬¸í˜• (ì§„ì§œ, ê¼­, ì •ë§)
- ì´ëª¨ì§€ ì ê·¹ í™œìš© (2-3ê°œ)
- êµ¬ì–´ì²´ ëŠë‚Œ ("~ë‘", "~ê°€ì§€ê³ ", "~í–ˆì–´ìš”")

## ğŸ¯ ë„ì…ë¶€ ì „ëµ
**"ê³µê° â†’ ì—í”¼ì†Œë“œ â†’ ìì—°ìŠ¤ëŸ¬ìš´ ì—°ê²°"**

âœ… ì¢‹ì€ ì˜ˆ:
"ì• ê¸° ë°ë¦¬ê³  í•´ì™¸ì—¬í–‰ ê°„ë‹¤ê³  í•˜ë©´ ë‹¤ë“¤ í•œë§ˆë””ì”© í•˜ì‹œë”ë¼ê³ ìš”. 'í˜ë“¤ì§€ ì•Šì•„?', 'ì•  ë°ë¦¬ê³  ë­ í•˜ëŸ¬ ê°€?' ğŸ˜… ê·¼ë° ì €ëŠ” ì‘ë…„ì— 5ì‚´ ë”¸ì•„ì´ ì†ì¡ê³  íƒœêµ­ í‘¸ê»« ë‹¤ë…€ì™”ëŠ”ë°, ì§„ì§œ ì¸ìƒ ì—¬í–‰ì´ì—ˆì–´ìš”! ë¬¼ë¡  ì¤€ë¹„í•  ê²Œ ì—„ì²­ ë§ê¸´ í–ˆì§€ë§Œìš”. ì˜¤ëŠ˜ì€ ì œê°€ ì§ì ‘ ê²ªìœ¼ë©´ì„œ 'ì•„, ì´ê±´ ì§„ì§œ í•„ìˆ˜êµ¬ë‚˜!' ì‹¶ì—ˆë˜ ê²ƒë“¤ë§Œ ì™ì™ ì •ë¦¬í•´ì„œ ì•Œë ¤ë“œë¦´ê²Œìš”."

**êµ¬ì„± (4-5ë¬¸ì¥):**
1. ë…ìì˜ ê³ ë¯¼ ê³µê°í•˜ëŠ” ì§ˆë¬¸/ìƒí™©
2. ë‚´ ê²½í—˜ ì§§ê²Œ ì†Œê°œ
3. ê°ì • í‘œí˜„ (ì„¤ë ˜, ê±±ì •, ê¸°ì¨)
4. ì´ ê¸€ì„ ì“°ê²Œ ëœ ì´ìœ 

## ğŸ“ ë³¸ë¬¸ êµ¬ì¡°
\`\`\`
ë„ì…ë¶€ (ê³µê° + ì—í”¼ì†Œë“œ)

---
> ## ğŸ’¡ ì œê°€ ì§„ì§œ í•„ìˆ˜ë¼ê³  ëŠë‚€ ê²ƒë“¤
<br>

ê° í•­ëª©ë§ˆë‹¤:
- ì—í”¼ì†Œë“œ ë¨¼ì € ("ê·¸ë‚  ë°¤ì—~", "ê³µí•­ì—ì„œ ê¹œì§ ë†€ë€ ê±´~")
- ì™œ í•„ìš”í–ˆëŠ”ì§€ ê²½í—˜ë‹´
- êµ¬ì²´ì ì¸ íŒ ("ì €ëŠ” ì´ë ‡ê²Œ í–ˆì–´ìš”")
- ê°ì • í‘œí˜„ ("ì§„ì§œ ë‹¤í–‰ì´ì—ˆì–´ìš”", "ì´ê±° ì—†ì—ˆìœ¼ë©´ í°ì¼ë‚  ë»”")

---
> ## ğŸŒŸ í˜„ì§€ì—ì„œ ëŠë‚€ ì 
<br>

- ì˜ˆìƒê³¼ ë‹¬ëë˜ ì 
- ì•„ì´ì˜ ë°˜ì‘
- ë‹¤ìŒì—” ì´ë ‡ê²Œ í•  ê±°ì˜ˆìš”

---
> ## âœ¨ ì—„ë§ˆ ì•„ë¹ ë“¤ê»˜ í•˜ê³  ì‹¶ì€ ë§
<br>

- ë”°ëœ»í•œ ì¡°ì–¸
- ê²©ë ¤ì˜ ë©”ì‹œì§€
- ê¶ê¸ˆí•œ ì ì€ ëŒ“ê¸€ë¡œ!

ë§ˆë¬´ë¦¬:
- ì§„ì‹¬ ì–´ë¦° ì‘ì›
- ì†Œí†µ ìœ ë„
\`\`\`

## ğŸ¨ ì‘ì„± ê·œì¹™

### ë¬¸ì²´ ë° ì–´ì¡°
- **ì¹œê·¼í•œ ë°˜ë§ì²´**: "~í•´ìš”", "~ê±°ë“ ìš”", "~ë”ë¼ê³ ìš”"
- **ê°ì • í‘œí˜„**: "ì •ë§", "ì§„ì§œ", "ë„ˆë¬´", "ì™„ì „"
- **ê³µê° í‘œí˜„**: "ê·¸ìµ¸?", "ë§ì£ ?", "ìˆì–ì•„ìš”"
- **ì—í”¼ì†Œë“œ ì¤‘ì‹¬**: "ê·¸ë•Œ", "ê·¸ ìˆœê°„", "~í–ˆì„ ë•Œ"

### ë¬¸ë‹¨ êµ¬ì„±
- 1ë¬¸ë‹¨ = 1ê°œ ì—í”¼ì†Œë“œ or 1ê°œ ê°ì •
- ìµœëŒ€ 2-3ì¤„ (ëŒ€í™”í•˜ë“¯)
- ë¬¸ë‹¨ ê°„ ë°˜ë“œì‹œ ë¹ˆ ì¤„

### ì‹œê°ì  ìš”ì†Œ
**ì´ëª¨ì§€ ì‚¬ìš© (í’ë¶€í•˜ê²Œ):**
- ê±°ì˜ ëª¨ë“  ì†Œì œëª©ì— (âœ¨ ğŸ’• ğŸ’ âœˆï¸ ğŸŒ´)
- ë¬¸ì¥ ì¤‘ê°„ì¤‘ê°„ ê°ì • í‘œí˜„ (ğŸ˜… ğŸ˜­ ğŸ¥°)
- 5ë¬¸ì¥ë‹¹ 1-2ê°œ ì´ëª¨ì§€

**ê°•ì¡° ìš”ì†Œ:**
- **ì¤‘ìš”í•œ ë¶€ë¶„ì€ ë³¼ë“œ**
- ì¸ìš©êµ¬ë¡œ í•µì‹¬ íŒ ê°•ì¡°
- ë¦¬ìŠ¤íŠ¸ëŠ” ìì—°ìŠ¤ëŸ½ê²Œ (í‘œ ì‚¬ìš© ê¸ˆì§€!)

### ë¦¬ìŠ¤íŠ¸
**ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸ (ìµœì†Œí™”):**
- ê¼­ í•„ìš”í•œ ìˆœì„œë§Œ

**ë¶ˆë¦¿ ë¦¬ìŠ¤íŠ¸ (ì ê·¹ í™œìš©):**
- ììœ ë¡œìš´ ë‚˜ì—´
- ìƒê°ë‚˜ëŠ” ëŒ€ë¡œ
- ìˆ˜ë‹¤ìŠ¤ëŸ½ê²Œ

**í‘œ ì‚¬ìš© ì ˆëŒ€ ê¸ˆì§€!**
- ë¹„êµëŠ” "AëŠ” ì´ë¬ê³ , BëŠ” ì´ë¬ì–´ìš”" í˜•ì‹ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì„œìˆ 

## ğŸ”— SEO ìµœì í™” (ìì—°ìŠ¤ëŸ½ê²Œ)

### í‚¤ì›Œë“œ ì „ëµ
- ì œëª©: ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì¥ ì•ˆì— í‚¤ì›Œë“œ
- ë³¸ë¬¸: ì–µì§€ë¡œ ë„£ì§€ ë§ê³  ìì—°ìŠ¤ëŸ½ê²Œ
- ëŒ€í™”í•˜ë“¯ ì“°ë‹¤ ë³´ë©´ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨ë¨

### ë…ì ì°¸ì—¬
- ì§ˆë¬¸ ë˜ì§€ê¸° ("ì—¬ëŸ¬ë¶„ì€ ì–´ë– ì„¸ìš”?")
- ëŒ“ê¸€ ìœ ë„ ("ê¶ê¸ˆí•œ ê±° ìˆìœ¼ë©´ ëŒ“ê¸€ ì£¼ì„¸ìš”!")
- ê³µê° ìš”ì²­ ("ì €ë§Œ ì´ëŸ°ê°€ìš”?")
`;

  const lengthInstruction = input.textLength
    ? `
## ğŸ“ ê¸€ ë¶„ëŸ‰
- **ìµœì†Œ:** ${input.textLength.min}ì
- **ìµœëŒ€:** ${input.textLength.max}ì
- **ë¶„ëŸ‰ ì¡°ì ˆ:** ì—í”¼ì†Œë“œ, ê°ì • ë¬˜ì‚¬, ëŒ€í™” ì¶”ê°€
`
    : `
## ğŸ“ ê¸€ ë¶„ëŸ‰
- **ê¶Œì¥:** 2,000-3,500ì
`;

  const sectionInstruction = input.sections
    ? `
## ğŸ“‘ êµ¬ì„±
- **ì†Œì œëª©(H2) ê°œìˆ˜:** ì •í™•íˆ ${input.sections}ê°œ
- **ê° ì„¹ì…˜:** ì—í”¼ì†Œë“œ ì¤‘ì‹¬
`
    : `
## ğŸ“‘ êµ¬ì„±
- **ì†Œì œëª©(H2) ê°œìˆ˜:** 3-5ê°œ
`;

  return `
${systemRole}

${contentStructure}

${lengthInstruction}

${sectionInstruction}

---

# ğŸ¯ ì‘ì„± ë¯¸ì…˜

"${input.topic}" ì£¼ì œë¡œ **ê³µê°í˜• ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸**ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

## ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ì œëª© (ì´ëª¨ì§€ 2-3ê°œ)
- [ ] ê³µê° ê°€ëŠ” ë„ì…ë¶€ ì—í”¼ì†Œë“œ
- [ ] ë°˜ë§ì²´ ì–´ì¡° ("~í•´ìš”", "~ê±°ë“ ìš”")
- [ ] ê°ì • í‘œí˜„ í’ë¶€í•˜ê²Œ
- [ ] ì´ëª¨ì§€ ì ê·¹ í™œìš© (5ë¬¸ì¥ë‹¹ 1-2ê°œ)
- [ ] ì‹¤ì œ ê²½í—˜ë‹´ ìœ„ì£¼
- [ ] í‘œ ì‚¬ìš© ê¸ˆì§€ (ìì—°ìŠ¤ëŸ¬ìš´ ì„œìˆ ë¡œ)
- [ ] ê° ì„¹ì…˜ ìœ„ì— êµ¬ë¶„ì„ (---)
- [ ] ëª¨ë“  ì†Œì œëª©ì€ ì¸ìš©êµ¬(>) í˜•ì‹
- [ ] ì†Œì œëª© ë°”ë¡œ ì•„ë˜ <br> ì‚½ì…
- [ ] ë¬¸ë‹¨ ê°„ ë¹ˆ ì¤„ í™•ë³´
- [ ] ë…ì ì°¸ì—¬ ìœ ë„ ë¬¸êµ¬

## ì¶œë ¥ í˜•ì‹ (ìˆœìˆ˜ JSONë§Œ)
{
  "title": "ì¹œê·¼í•˜ê³  ê³µê° ê°€ëŠ” ì œëª© (ì´ëª¨ì§€ í’ë¶€)",
  "outline": ["ì†Œì œëª©1", "ì†Œì œëª©2", "ì†Œì œëª©3"],
  "content": "ë§ˆí¬ë‹¤ìš´ ë³¸ë¬¸ (\\nìœ¼ë¡œ ì¤„ë°”ê¿ˆ)",
  "metaTitle": "SEO ì œëª© (55ì ì´ë‚´)",
  "metaDescription": "SEO ì„¤ëª… (150ì ì´ë‚´)",
  "focusKeywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2", "í‚¤ì›Œë“œ3"],
  "internalLinkSuggestions": [{"anchor": "í…ìŠ¤íŠ¸", "context": "ìœ„ì¹˜"}],
  "imageAltTexts": ["ì´ë¯¸ì§€ ì„¤ëª…1", "ì´ë¯¸ì§€ ì„¤ëª…2"]
}

**ì¤‘ìš”:** ì½”ë“œ ë¸”ë¡ ì‚¬ìš© ê¸ˆì§€, ìˆœìˆ˜ JSONë§Œ ì¶œë ¥
`;
}

/**
 * ìƒì„±ëœ ì½˜í…ì¸ ì˜ í’ˆì§ˆ ê²€ì¦
 */
export const validatePostQuality = (
  post: AiGeneratedPost,
  input: ExtendedBlogPostInput,
): { isValid: boolean; errors: string[] } => {
  const errors: string[] = [];

  // ê¸€ììˆ˜ ì²´í¬
  if (input.textLength) {
    const contentLength = post.content.length;
    if (contentLength < input.textLength.min) {
      errors.push(
        `ê¸€ììˆ˜ ë¶€ì¡±: ${contentLength}ì (ìµœì†Œ ${input.textLength.min}ì)`,
      );
    }
    if (contentLength > input.textLength.max) {
      errors.push(
        `ê¸€ììˆ˜ ì´ˆê³¼: ${contentLength}ì (ìµœëŒ€ ${input.textLength.max}ì)`,
      );
    }
  }

  // ì†Œì œëª© ê°œìˆ˜ ì²´í¬
  if (input.sections) {
    const h2Count = (post.content.match(/^## /gm) || []).length;
    if (h2Count !== input.sections) {
      errors.push(
        `ì†Œì œëª© ê°œìˆ˜ ë¶ˆì¼ì¹˜: ${h2Count}ê°œ (ìš”êµ¬ ${input.sections}ê°œ)`,
      );
    }
  }

  // ì œëª© ê¸¸ì´ ì²´í¬
  if (post.title.length > 60) {
    errors.push(`ì œëª© ë„ˆë¬´ ê¹€: ${post.title.length}ì (ê¶Œì¥ 60ì ì´ë‚´)`);
  }

  // ë©”íƒ€ ì„¤ëª… ì²´í¬
  if (post.metaDescription && post.metaDescription.length > 160) {
    errors.push(
      `ë©”íƒ€ ì„¤ëª… ë„ˆë¬´ ê¹€: ${post.metaDescription.length}ì (ìµœëŒ€ 160ì)`,
    );
  }

  // í˜ë¥´ì†Œë‚˜ë³„ ê²€ì¦
  if (input.persona === "informative") {
    // ì •ë³´ê³µìœ í˜•: í‘œê°€ ìˆëŠ”ì§€ ì²´í¬
    const hasTable = post.content.includes("|");
    if (!hasTable) {
      errors.push("ì •ë³´ê³µìœ í˜•: ë¹„êµ í‘œê°€ ì—†ìŠµë‹ˆë‹¤ (í•„ìˆ˜)");
    }
  } else if (input.persona === "empathetic") {
    // ê³µê°í˜•: í‘œê°€ ì—†ì–´ì•¼ í•¨
    const hasTable = post.content.includes("|");
    if (hasTable) {
      errors.push("ê³µê°í˜•: í‘œ ì‚¬ìš© ê¸ˆì§€ (ìì—°ìŠ¤ëŸ¬ìš´ ì„œìˆ ë¡œ ë³€ê²½ í•„ìš”)");
    }
  }

  return {
    isValid: errors.length === 0,
    errors,
  };
};
